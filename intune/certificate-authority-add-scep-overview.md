---
title: Использование сторонних ЦС с SCEP в Microsoft Intune в Azure | Документы Майкрософт
description: В Microsoft Intune можно добавить центр сертификации (ЦС) поставщика или сторонний ЦС для выдачи сертификатов для мобильных устройств, использующих протокол SCEP. В этом обзоре приложение Azure Active Directory (Azure AD) предоставляет Microsoft Intune разрешения для проверки сертификатов. Затем идентификатор приложения, ключ проверки подлинности и идентификатор клиента приложения AAD используются при настройке сервера SCEP для выдачи сертификатов.
keywords: ''
author: MandiOhlinger
ms.author: mandia
manager: dougeby
ms.date: 07/26/2018
ms.topic: conceptual
ms.prod: ''
ms.service: microsoft-intune
ms.localizationpriority: high
ms.technology: ''
ms.reviewer: ''
ms.suite: ems
search.appverid: MET150
ms.custom: intune-azure
ms.collection: M365-identity-device-management
ms.openlocfilehash: d042a160d016343c6e8374dff8f74560b9806014
ms.sourcegitcommit: 143dade9125e7b5173ca2a3a902bcd6f4b14067f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61508490"
---
# <a name="add-partner-certification-authority-in-intune-using-scep"></a>Добавление центра сертификации партнера в Intune с помощью SCEP

В Microsoft Intune можно добавить сторонние центры сертификации (ЦС). Такие ЦС могут доставлять сертификаты на мобильные устройства с помощью протокола SCEP. Эта функция может выдавать новые сертификаты и продлять их на устройствах Windows, iOS, Android и macOS.

Использование этой функции включает две части: API с открытым исходным кодом и задачи администратора Intune.

**Часть 1. Использование API с открытым исходным кодом**  
Специалисты Майкрософт разработали API, который интегрируется с Intune для проверки сертификатов, отправки уведомления об успехе или неудаче и использования протокола SSL (в частности фабрики сокетов SSL) для обмена данными с Intune.

Этот API можно скачать в [общедоступном репозитории GitHub для API SCEP Intune](http://github.com/Microsoft/Intune-Resource-Access/tree/develop/src/CsrValidation) и использовать в своих решениях. Этот API можно использовать со сторонними серверами SCEP, чтобы выполнять собственную проверку запроса защиты в Intune перед доставкой сертификата на устройство.

В статье, посвященной [интеграции с решением по управлению SCEP в Intune](scep-libraries-apis.md), содержатся дополнительные сведения об использовании API, его методах и тестировании созданного решения.

**Часть 2. Создание приложения и профиля**  
С помощью приложения Azure Active Directory (Azure AD) можно делегировать Intune права на обработку запросов SCEP, поступающих с устройств. Приложение Azure AD включает идентификатор приложения и значения ключа проверки подлинности, которые используются в решении API, создаваемом разработчиком. Затем администраторы могут создавать и развертывать профили сертификатов SCEP с помощью Intune. Можно также просматривать отчеты о состоянии развертывания на устройствах.

В этой статье приводится обзор этой функции с точки зрения администратора, включая создание приложения Azure AD.

## <a name="overview"></a>Обзор

Ниже приведены общие сведения о процедуре выдачи сертификатов SCEP в Intune.

1. В Intune администратор создает профиль сертификата SCEP, а затем назначает этот профиль пользователям или устройствам.
2. Устройство регистрируется в Intune.
3. Intune создает уникальный запрос защиты SCEP. Кроме того, платформа добавляет сведения дополнительной проверки целостности, например об ожидаемом субъекте и SAN.
4. Intune шифрует и подписывает как запрос, так и сведения проверки целостности, а затем отправляет эти сведения на устройство с помощью запроса SCEP.
5. Устройство создает запрос подписи сертификата и пару открытого и закрытого ключей на устройстве в зависимости от профиля сертификата SCEP, который был отправлен из Intune.
6. Запрос подписи и зашифрованный или подписанный запрос защиты отправляются в стороннюю конечную точку сервера SCEP.
7. Сервер SCEP отправляет запрос подписи и запрос защиты в Intune. Затем Intune проверяет подпись, расшифровывает полезные данные и сравнивает запрос подписи со сведениями проверки целостности.
8. Intune отправляет ответ обратно на сервер SCEP и указывает, успешно ли выполнена проверка запроса защиты.  
9. Если запрос успешно проверен, сервер SCEP выдает сертификат для устройства.

На схеме ниже показан подробный поток интеграции сторонних SCEP с Intune:

![Интеграция SCEP стороннего центра сертификации с Microsoft Intune](./media/scep-certificate-vendor-integration.png)

## <a name="set-up-third-party-ca-integration"></a>Настройка интеграции сторонних ЦС

### <a name="validate-third-party-certification-authority"></a>Проверка сторонних центров сертификации

Перед интеграцией сторонних центров сертификации с Intune убедитесь, что используемый ЦС поддерживает Intune. В разделе [Сторонние центры сертификации партнеров](#third-party-certification-authority-partners) (этой статьи) содержится соответствующий список. Дополнительные сведения также можно найти в руководстве по центру сертификации. ЦС может включать специальные инструкции по установке в зависимости от реализации.

### <a name="authorize-communication-between-ca-and-intune"></a>Авторизация обмена данными между ЦС и Intune

Чтобы разрешить стороннему серверу SCEP выполнять пользовательскую проверку запроса защиты в Intune, создайте приложение в Azure AD. Это приложение делегирует Intune права для проверки запросов SCEP.

Убедитесь, что у вас есть необходимые разрешения для регистрации приложения Azure AD. Дополнительные сведения см. в разделе [Необходимые разрешения](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#required-permissions).

**Шаг 1. Создание приложения Azure AD**

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите **Azure Active Directory** > **Регистрация приложений** > **Регистрация нового приложения**.
3. Введите имя и URL-адрес входа. В поле "Тип приложения" выберите **Веб-приложение или API**.
4. Выберите **Создать**.

В разделе [Интеграция приложений с Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications) приводятся некоторые рекомендации по созданию приложения, включая советы по URL-адресу и имени.

**Шаг 2. Предоставление разрешений**

После создания приложения нужно предоставить API Microsoft Intune необходимые разрешения.

1. В приложении Azure AD откройте раздел **Параметры** > **Необходимые разрешения**.  
2. Выберите **Добавить** > **Выбор API** > выберите **Microsoft Intune API** > **Выбрать**.
3. В разделе **Выбор разрешений** выберите **Проверка запроса защиты SCEP** > **Выбрать**.
4. Нажмите кнопку **Готово**, чтобы сохранить изменения.

**Шаг 3. Получение идентификатора приложения и ключа проверки подлинности**

Получите значения идентификатора и ключа для приложения Azure AD. Необходимы следующие значения:

- Идентификатор приложения
- Ключ проверки подлинности
- Идентификатор клиента

**Получение идентификатора приложения и ключа проверки подлинности**

1. В Azure AD выберите ваше новое приложение (**Регистрация приложений**).
2. Скопируйте **идентификатор приложения** и сохраните его в коде приложения.
3. Затем создайте ключ проверки подлинности. В приложении Azure AD откройте **Параметры** > **Ключи**.
4. В поле **Пароли** введите описание и выберите период действия ключа. **Сохраните** внесенные изменения. Скопируйте и сохраните показанное значение.

    > [!IMPORTANT]
    > Скопируйте и сохраните этот ключ немедленно, так как он больше не отображается. Это значение ключа потребуется для реализации стороннего ЦС. Обязательно изучите руководство ЦС, чтобы получить представление о правильной настройке идентификатора приложения, ключа проверки подлинности и идентификатора клиента.

**Идентификатор клиента** — это текст имени домена после символа @ в вашей учетной записи. Например, если ваша учетная запись — `admin@name.onmicrosoft.com`, то идентификатор клиента — **name.onmicrosoft.com**.

В разделе [Получение идентификатора приложения и ключа проверки подлинности](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#get-application-id-and-authentication-key) перечислены действия для получения этих значений, а также дополнительные сведения о приложениях Azure AD.

### <a name="configure-and-deploy-a-scep-certificate-profile"></a>Настройка и развертывание профиля сертификата SCEP
Как администратор создайте профиль сертификата SCEP, предназначенный для пользователей или устройств. Затем назначьте профиль.

- [Создание профиля сертификата SCEP](certificates-scep-configure.md#create-a-scep-certificate-profile)

- [Назначение профиля сертификата](certificates-scep-configure.md#assign-the-certificate-profile)

## <a name="removing-certificates"></a>Удаление сертификатов

При отмене регистрации или очистке устройства сертификаты будут удалены. Отзыв сертификатов не выполняется.

## <a name="third-party-certification-authority-partners"></a>Сторонние центры сертификации партнеров
Следующие сторонние центры сертификации поддерживают Intune:

- [Entrust Datacard](http://www.entrustdatacard.com/resource-center/documents/documentation)
- [EJBCA — версия с открытым исходным кодом в GitHub](https://github.com/agerbergt/intune-ejbca-connector)
- [EverTrust](https://evertrust.fr/en/products/)

Если вы являетесь поставщиком стороннего ЦС, заинтересованным в интеграции вашего продукта с Intune, просмотрите руководство по API:

- [Репозиторий GitHub для API SCEP Intune](http://github.com/Microsoft/Intune-Resource-Access/tree/develop/src/CsrValidation)
- [Руководство по API SCEP Intune для сторонних центров сертификации](scep-libraries-apis.md)

## <a name="see-also"></a>См. также

- [Настройка профилей сертификатов](certificates-scep-configure.md)
- [Репозиторий GitHub для API SCEP Intune](http://github.com/Microsoft/Intune-Resource-Access/tree/develop/src/CsrValidation)
- [Руководство по API SCEP Intune для сторонних центров сертификации](scep-libraries-apis.md)
