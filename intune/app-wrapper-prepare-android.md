---
title: Создание программы-оболочки Intune для приложений Android с помощью соответствующего инструмента
description: Узнайте, как создать программу-оболочку для приложений Android, не меняя код самого приложения, а также подготовить приложения для применения политики управления мобильными приложениями.
keywords: ''
author: Erikre
ms.author: erikre
manager: dougeby
ms.date: 12/12/2018
ms.topic: article
ms.prod: ''
ms.service: microsoft-intune
ms.technology: ''
ms.assetid: e9c349c8-51ae-4d73-b74a-6173728a520b
ms.reviewer: aanavath
ms.suite: ems
search.appverid: MET150
ms.custom: intune-classic
ms.openlocfilehash: e9d3b82fb544b1c73671438440b108573343795a
ms.sourcegitcommit: 874d9a00cc4666920069d54f99c6c2e687fa34a6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/13/2018
ms.locfileid: "53324911"
---
# <a name="prepare-android-apps-for-app-protection-policies-with-the-intune-app-wrapping-tool"></a>Подготовка приложений Android для применения политик защиты приложений с помощью инструмента упаковки приложений

[!INCLUDE [both-portals](./includes/note-for-both-portals.md)]

Инструмент упаковки для приложений Microsoft Intune для Android используется для изменения поведения внутрикорпоративных приложений Android за счет ограничения возможностей приложения без изменения кода самого приложения.

Этот инструмент представляет собой программу командной строки Windows, которая выполняется в PowerShell и создает "оболочку" вокруг приложения Android. После упаковки приложения его функциональность можно изменить, настроив [политики управления мобильными приложениями](app-protection-policies.md) в Intune.


Перед запуском инструмента просмотрите раздел [Вопросы безопасности при запуске инструмента упаковки для приложений](#security-considerations-for-running-the-app-wrapping-tool). Чтобы скачать этот инструмент, посетите раздел [Microsoft Intune App Wrapping Tool for Android](https://github.com/msintuneappsdk/intune-app-wrapping-tool-android) (Инструмент упаковки для приложений Microsoft Intune для Android) на GitHub.

## <a name="fulfill-the-prerequisites-for-using-the-app-wrapping-tool"></a>Выполнение необходимых условий для использования средства изоляции приложений

-   Инструмент упаковки для приложений необходимо запустить на компьютере под управлением Windows 7 или более поздней версии Windows.

-   Входное приложение должно представлять собой допустимый пакет приложения Android с расширением APK, а также:

    -   не может быть зашифровано;
    -   не может быть упаковано с помощью инструмента упаковки для приложений Intune;
    -   должно быть написано для Android 4.0 или более поздней версии.

-   Приложение должно быть разработано внутри вашей компании или по ее заказу. Этот инструмент невозможно использовать для приложений, скачанных из магазина Google Play.

-   Чтобы запустить инструмент, необходимо установить последнюю версию [среды выполнения Java](https://java.com/download/) и убедиться, что для переменной пути Java в переменных среды Windows задано значение C:\ProgramData\Oracle\Java\javapath. Дополнительные сведения см. в [документации по Java](https://java.com/download/help/).

    > [!NOTE]
    > В некоторых случаях 32-разрядная версия Java может привести к проблемам с памятью. Рекомендуется установить 64-разрядную версию.

- В Android все пакеты приложений (.apk) должны быть подписаны. Сведения о **повторном использовании** существующих сертификатов и общее руководство о сертификатах для подписи см. в статье [Повторное использование сертификатов для подписи и упаковка приложений](https://docs.microsoft.com/intune/app-wrapper-prepare-android#reusing-signing-certificates-and-wrapping-apps). Исполняемый файл keytool.exe Java используется для **создания** учетных данных, необходимых для подписи упакованного выходного приложения. Все заданные пароли должны быть безопасными, но не забывайте их, так как они потребуются позже для запуска инструмента упаковки для приложений.

> [!NOTE]
> Инструмент упаковки приложений Intune не поддерживает версию 2 и грядущую версию 3 схем подписей Google для подписывания приложений. После упаковки APK-файла с помощью инструмента упаковки приложений Intune рекомендуется использовать [средство Apksigner, предоставляемое Google]( https://developer.android.com/studio/command-line/apksigner). Это гарантирует, что на устройствах конечных пользователей приложение будет запускаться корректно, в соответствии со стандартами Android. 

- Включите Multidex во входном приложении (необязательно). Иногда в приложении может достигаться максимальный размер исполняемого файла Dalvik (DEX) из-за классов пакета SDK для Intune MAM, которые добавляются во время упаковки. Файлы DEX являются частью компиляции приложения Android. В такой ситуации рекомендуется включить Multidex в самом приложении. В некоторых организациях для этого может потребоваться взаимодействие с теми, кто компилирует приложение (например, с группой по сборке приложений). 

## <a name="install-the-app-wrapping-tool"></a>Установка инструмента упаковки для приложений

1.  Из [репозитория GitHub](https://github.com/msintuneappsdk/intune-app-wrapping-tool-android) скачайте на компьютер Windows установочный файл инструмента упаковки для приложений Intune в Android — InstallAWT.exe. Откройте установочный файл.

2.  Примите условия лицензионного соглашения, а затем завершите установку.

Запомните папку, в которую был установлен инструмент. Расположение по умолчанию: C:\Program Files (x86)\Microsoft Intune Mobile Application Management\Android\App Wrapping Tool.

## <a name="run-the-app-wrapping-tool"></a>Запуск инструмента упаковки для приложений

1. На компьютере Windows, где установлен инструмент упаковки для приложений, откройте окно PowerShell.

2. Из папки, куда был установлен инструмент, импортируйте модуль PowerShell инструмента упаковки для приложений:

   ```PowerShell
   Import-Module .\IntuneAppWrappingTool.psm1
   ```

3. Запустите инструмент с помощью команды **invoke-AppWrappingTool** со следующим синтаксисом.
   ```PowerShell
   Invoke-AppWrappingTool [-InputPath] <String> [-OutputPath] <String> -KeyStorePath <String> -KeyStorePassword <SecureString>
   -KeyAlias <String> -KeyPassword <SecureString> [-SigAlg <String>] [<CommonParameters>]
   ```

   В следующей таблице приведены свойства команды **invoke-AppWrappingTool**.

|Свойство|Данные|Пример|
|-------------|--------------------|---------|
|**-InputPath**&lt;строка&gt;|Путь исходного приложения Android (APK).| |
 |**-OutputPath**&lt;строка&gt;|Путь к "выходному" приложению Android. Если это тот же путь к каталогу, что и InputPath, произойдет сбой упаковки.| |
|**-KeyStorePath**&lt;строка&gt;|Путь к KEYSTORE-файлу, который содержит пару открытого и закрытого ключей для подписания.|По умолчанию файлы хранилища ключей находятся в папке "C:\Program Files (x86)\Java\jreX.X.X_XX\bin". |
|**-KeyStorePassword**&lt;SecureString&gt;|Пароль, используемый для расшифровки KEYSTORE-файла. Для Android требуется, чтобы все пакеты приложения (с расширением APK) были подписаны. Используйте средство Java KeyTool, чтобы создать пароль для хранилища ключей. Дополнительные сведения о Java [KeyStore](https://docs.oracle.com/javase/7/docs/api/java/security/KeyStore.html) Java см. здесь.| |
|**-KeyAlias**&lt;строка&gt;|Имя ключа, используемого для подписания.| |
|**-KeyPassword**&lt;SecureString&gt;|Пароль, используемый для расшифровки закрытого ключа, который будет использоваться для подписания.| |
|**-SigAlg**&lt;SecureString&gt;| (Необязательно.) Имя используемого алгоритма подписи. Этот алгоритм должен быть совместим с закрытым ключом.|Примеры: SHA256withRSA, SHA1withRSA|
| **&lt;CommonParameters&gt;** | Команда поддерживает общие параметры PowerShell, такие как verbose и debug (необязательно). |


- Список общих параметров см. в разделе [Центр скриптов Майкрософт](https://technet.microsoft.com/library/hh847884.aspx).

- Чтобы просмотреть подробные сведения об использовании инструмента, введите следующую команду.

    ```PowerShell
    Help Invoke-AppWrappingTool
    ```

**Пример:**

Импорт модуля PowerShell.
```PowerShell
Import-Module "C:\Program Files (x86)\Microsoft Intune Mobile Application Management\Android\App Wrapping Tool\IntuneAppWrappingTool.psm1"
```
Запустите инструмент упаковки для приложений в собственном приложении HelloWorld.apk.
```PowerShell
invoke-AppWrappingTool -InputPath .\app\HelloWorld.apk -OutputPath .\app_wrapped\HelloWorld_wrapped.apk -KeyStorePath "C:\Program Files (x86)\Java\jre1.8.0_91\bin\mykeystorefile" -keyAlias mykeyalias -SigAlg SHA1withRSA -Verbose
```

Затем появится запрос на **KeyStorePassword** и **KeyPassword**. Введите учетные данные, использованные при создании файла ключа хранилища.

Упакованное приложение и файл журнала создаются и сохраняются по указанному выходному пути.

## <a name="how-often-should-i-rewrap-my-android-application-with-the-intune-app-wrapping-tool"></a>Как часто следует повторно упаковывать приложение Android с помощью инструмента упаковки для приложений Intune?
Ниже приводятся основные сценарии, в которых потребуется повторная упаковка приложений.
* Вышла новая версия приложения. Предыдущая версия приложения была упакована и отправлена в консоль Intune.
* Вышла новая версия инструмента упаковки для приложений Android Intune, в которой исправлены ключевые ошибки или добавлены новые функции политики защиты приложений Intune. Это происходит каждые 6–8 недель в репозитории GitHub [инструмента упаковки для приложений Android Microsoft Intune](https://github.com/msintuneappsdk/intune-app-wrapping-tool-android).

Далее приводятся некоторые рекомендации по повторной упаковке. 
* Сведения о поддержке сертификатов для подписи, используемых в процессе сборки, см. в разделе [Повторное использование сертификатов для подписи и упаковка приложений](https://docs.microsoft.com/intune/app-wrapper-prepare-android#reusing-signing-certificates-and-wrapping-apps).

## <a name="reusing-signing-certificates-and-wrapping-apps"></a>Повторное использование сертификатов для подписи и упаковка приложений
Для установки любого приложения на устройства с ОС Android у него должен иметься допустимый сертификат в качестве подписи.

Упакованные приложения можно подписать с помощью имеющихся у вас средств для подписи либо в процессе упаковки, либо *после* нее (любые сведения о подписи в приложении перед упаковкой удаляются). По возможности используйте при упаковке сведения о подписи, которые уже использовались в процессе сборки. В некоторых организациях для этого может потребоваться привлечь владельцев данных хранилища ключей (например, группы по сборкам приложений). 

Если использовать предыдущий сертификат для подписи невозможно или приложение раньше не развертывалось, вы можете создать для подписи новый сертификат согласно указаниям в [руководстве разработчика Android](https://developer.android.com/studio/publish/app-signing.html#signing-manually).

Если приложение раньше развертывалось с другим сертификатом для подписи, его невозможно будет отправить в Intune после обновления. Если для подписи приложения используется не тот сертификат, который был использован для сборки, то сценарии обновления приложения работать не будут. Таким образом, необходимо поддерживать созданные сертификаты для подписи, если вы хотите обновлять приложения. 

## <a name="security-considerations-for-running-the-app-wrapping-tool"></a>Вопросы безопасности при запуске инструмента упаковки для приложений
Во избежание потенциального спуфинга, раскрытия информации и атак с несанкционированным повышением привилегий:

-   Убедитесь, что входное бизнес-приложение, выходное приложение и Java KeyStore находятся на том же компьютере Windows, где запущен инструмент упаковки для приложений.

-   Импортируйте выходное приложение в Intune на том же компьютере, где запущено средство. Дополнительные сведения о Java Keytool см. [здесь](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html).

-   Если выходное приложение и инструмент расположены по UNC-пути и вы не используете инструмент и входные файлы на одном и том же компьютере, настройте среду на безопасную работу с помощью [протокола IPsec](https://wikipedia.org/wiki/IPsec) или [подписывания SMB](https://support.microsoft.com/kb/887429).

-   Убедитесь, что приложение получено из надежного источника.

-   Обеспечьте безопасность выходного каталога, содержащего упакованное приложение. Рассмотрите возможность использования каталога уровня пользователя в качестве выходного каталога.

## <a name="requiring-user-login-prompt-for-an-automatic-app-we-service-enrollment-requiring-intune-app-protection-policies-in-order-to-use-your-wrapped-android-lob-app-and-enabling-adal-sso-optional"></a>Настройка обязательного входа пользователя в систему для автоматической регистрации в службе APP-WE, настройка обязательного применения политик защиты приложений Intune для использования упакованного бизнес-приложения Android и включение единого входа ADAL (необязательно)

Ниже приводятся указания по настройке обязательного запроса учетных данных пользователя при запуске приложения для автоматической регистрации в службе APP-WE (в этом разделе она называется **регистрацией по умолчанию**) и настройке политик защиты приложений Intune таким образом, чтобы они разрешали использование упакованного бизнес-приложения Android только пользователям, защищенным Intune. В нем также рассматривается включение единого входа для упакованного бизнес-приложения Android. 

> [!NOTE] 
> Преимущества **регистрации по умолчанию** включают в себя упрощенный способ получения политики из службы APP-WE для приложения на устройстве.

### <a name="general-requirements"></a>Общие требования
* Команда SDK Intune запросит идентификатор вашего приложения. Узнать его можно на [портале Azure](https://portal.azure.com/) на странице **Все приложения** в столбце **ИД приложения**. Связаться с командой SDK Intune можно по электронной почте: msintuneappsdk@microsoft.com.
     
### <a name="working-with-the-intune-sdk"></a>Работа с пакетом SDK Intune
Эти инструкции относятся ко всем приложениям для Android и Xamarin, которые нуждаются в обязательном применении политик защиты устройств Intune на устройстве конечного пользователя.

1. Настройте ADAL, выполнив инструкции в [руководство по пакету SDK Intune для Android](https://docs.microsoft.com/intune/app-sdk-android#configure-azure-active-directory-authentication-library-adal).

> [!NOTE]
> Под идентификатором клиента, привязанным к приложению, понимается идентификатор приложения на портале Azure. 
> * Чтобы включить единый вход, обратитесь к подразделу 2 в разделе "Распространенные конфигурации ADAL".

2. Включите регистрацию по умолчанию, добавив в манифест следующее значение:
   ```xml
   <meta-data android:name="com.microsoft.intune.mam.DefaultMAMServiceEnrollment" android:value="true" />
   ```
   > [!NOTE] 
   > Это должна быть единственная интеграция со службой MAM-WE в приложении. При наличии других вызовов интерфейсов API MAMEnrollmentManager могут возникнуть конфликты.

3. Включите требуемую политику MAM, добавив в манифест следующее значение:
   ```xml
   <meta-data android:name="com.microsoft.intune.mam.MAMPolicyRequired" android:value="true" />
   ```
   > [!NOTE] 
   > В результате пользователю будет необходимо скачать приложение корпоративного портала на устройстве и пройти процедуру регистрации по умолчанию перед использованием.

### <a name="see-also"></a>См. также:
- [Выбор способа подготовки приложений для управления мобильными приложениями с помощью Microsoft Intune](apps-prepare-mobile-application-management.md)

- [Руководство по пакету SDK для приложений Intune для разработчиков под Android](app-sdk-android.md)
