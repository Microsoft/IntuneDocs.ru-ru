---
title: Устранение неполадок интеграции Jamf Pro с Microsoft Intune
titleSuffix: Microsoft Intune
description: Рекомендации по устранению некоторых наиболее распространенных проблем при интеграции Jamf Pro для устройств Mac с Microsoft Intune.
keywords: ''
author: brenduns
ms.author: brenduns
manager: dougeby
ms.date: 10/02/2019
ms.topic: troubleshooting
ms.service: microsoft-intune
ms.subservice: protect
ms.localizationpriority: medium
ms.technology: ''
ms.assetid: ''
ms.reviewer: ''
search.appverid: MET150
ms.custom: intune-azure
ms.collection: M365-identity-device-management
ms.openlocfilehash: 44733eb369e520d2d5f0ff548d4f1921abcb8758
ms.sourcegitcommit: 9013f7442bbface78feecde2922e8e546a622c16
ms.translationtype: MTE75
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2019
ms.locfileid: "72503581"
---
# <a name="troubleshoot-integration-of-jamf-pro-with-microsoft-intune"></a>Устранение неполадок интеграции Jamf Pro с Microsoft Intune

Эта статья поможет администраторам Intune понять и устранить проблемы с интеграцией Jamf Pro для macOS с Intune.

> [!TIP]  
> Значительная часть информации в этой статье была [устранена при интеграции Jamf с Microsoft Intune](https://support.microsoft.com/help/4519171/troubleshoot-problems-when-integrating-jamf-with-microsoft-intune) support.Microsoft.com.

## <a name="prerequisites"></a>Предварительные условия

Прежде чем начать устранение неполадок, собирайте основные сведения, чтобы уточнить проблему и сократить время поиска решения. Например, при возникновении проблемы, связанной с интеграцией Jamf-Intune, всегда проверяйте, выполнены ли все необходимые условия. Прежде чем начать устранение неполадок, ознакомьтесь со следующими вопросами.

- Ознакомьтесь с предварительными требованиями из раздела [Интеграция Jamf Pro с Intune](conditional-access-integrate-jamf.md#prerequisites).
- Все пользователи должны иметь лицензии на Microsoft Intune и Microsoft AAD Premium P1 
- Необходимо иметь учетную запись пользователя, имеющую Microsoft Intune разрешения на интеграцию в консоли Jamf Pro.
- Необходимо иметь учетную запись пользователя, имеющую разрешения глобального администратора в Azure.


При исследовании интеграции Jamf Pro с Intune учитывайте следующие сведения: 
- Какое именно сообщение об ошибке отображается?
- Где это происходит?
- Когда появилась проблема?  Работает ли интеграция Jamf Pro с Intune?
- Сколько пользователей затронуты? Все ли пользователи затронули или только некоторые из них?
- Сколько затронутых устройств? Затрагиваются ли все устройства или только некоторые из них?
 

## <a name="common-problems"></a>Распространенные проблемы 

Следующие сведения помогут определить и устранить распространенные проблемы с устройствами после настройки интеграции Intune и Jamf Pro.  

| Проблема   | Дополнительные сведения                  |
|-----------------|--------------------------|
| **Устройства помечаются как не отвечающие в Jamf Pro**  | [Не удается выполнить возврат устройств с помощью Jamf Pro или Azure AD](#devices-are-marked-as-unresponsive-in-jamf-pro) |
| **Устройства Mac запрашивают вход в цепочку ключей при открытии устройств приложений не удается зарегистрировать**  | [Пользователям предлагается ввести пароль, чтобы разрешить приложениям регистрироваться в Azure AD](#mac-devices-prompt-for-keychain-sign-in-when-you-open-an-app). |
| **Не удается зарегистрировать устройства**  | Следующие причины могут быть применимы. <br> **-** [ ***Причина 1*** . приложение Jamf Pro в Azure имеет неверные разрешения](#cause-1) <br> **-** [***Причина 2***  — возникла ошибка для *Jamf собственного соединителя macOS*  в Azure AD.](#cause-2) <br> **-** [***Причина 3*** -у пользователя нет допустимой лицензии Intune или Jamf](#cause-3) <br> **-** [***Причина 4***  — пользователь не использовал самослужбу Jamf для запуска корпоративный портал приложения](#cause-4) <br> **-** [ ***Причина 5*** . Интеграция Intune отключена](#cause-5) <br> **-** [ ***Причина 6*** . устройство ранее было зарегистрировано в Intune, или пользователь попытался зарегистрировать устройство несколько раз.](#cause-6) <br> **-** [ ***приведет к тому*** , что 7-жамфаад запрашивает доступ к разделу "Microsoft Workplace Join Key" из цепочки пользователей.](#cause-7) |
|  **Устройство Mac соответствует требованиям в Intune, но не соответствует в Azure** | [Проблемы с регистрацией устройств](#mac-device-shows-compliant-in-intune-but-noncompliant-in-azure) |
| **В консоли Intune для устройств Mac, зарегистрированных с помощью Jamf, отображаются дублирующиеся записи** | [Несколько регистраций, из одно устройство](#duplicate-entries-appear-in-the-intune-console-for-mac-devices-enrolled-by-using-jamf) |
| **Политике соответствия не удалось оценить устройство** | [Политика нацелена на группы устройств](#compliance-policy-fails-to-evaluate-the-device) |
| **Не удалось получить маркер доступа для Microsoft Graph API** | Следующие причины могут быть применимы. <br> -[разрешения для приложения Jamf Pro в Azure](#theres-a-permission-issue-with-the-jamf-pro-application-in-azure) <br> - [срок действия лицензии для Jamf или Intune](#a-license-required-for-jamf-intune-integration-has-expired) <br> порты **-** [не открыты](#the-required-ports-arent-open-on-your-network)|
 

### <a name="devices-are-marked-as-unresponsive-in-jamf-pro"></a>Устройства помечаются как не отвечающие в Jamf Pro  

**Причина**. ниже приведены распространенные причины, по которым устройства отмечаются как не *отвечающие* Jamf Pro:

- Устройство не может выполнить возврат с помощью Jamf Pro.  
  Jamf Pro ждет, когда устройства будут проверяться каждые 15 минут. Устройства помечаются как не отвечающие Jamf, когда они не проверяются в течение 24-часового периода.  

- Устройство не может выполнить возврат с помощью Azure AD.  
  После успешной регистрации в Azure AD устройства macOS получают токен Azure:
  - Этот маркер обновляется каждые 12 часов.   
  - Если обновление маркера завершается сбоем в течение 24 часов или более, Jamf Pro помечает устройство как не отвечающее.  
  - Если срок действия маркера Azure истечет, пользователям будет предложено войти в Azure для получения нового маркера. Маркер обновления для доступа к Azure создается каждые семь дней.

**Решение**  
После того как устройство будет помечено как не *отвечающее* Jamf Pro, зарегистрированный пользователь устройства должен войти в систему, чтобы исправить состояние без реагирования. Это должен быть пользователь, который присоединяется к учетной записи, так как она имеет удостоверение из Intune в цепочке ключей для входа.



### <a name="mac-devices-prompt-for-keychain-sign-in-when-you-open-an-app"></a>Устройства Mac запрашивают вход с помощью цепочки ключей при открытии приложения  

После настройки интеграции Intune и Jamf Pro и развертывания политик условного доступа пользователи устройств, управляемых с помощью Jamf Pro, получают запрос на ввод пароля при открытии приложений Microsoft Office 365, таких как команды, Outlook и другие приложения, для которых требуется Azure. Проверка подлинности Active Directory. 

Например, при открытии Microsoft Teams появляется запрос с текстом, аналогичным приведенному ниже.

``` 
  Microsoft Teams wants to sign using key “Microsoft Workplace Join Key” in your keychain.  
  To allow this, enter the “login” keychain password 
```

**Причина**. Эти запросы создаются Jamf Pro для каждого применимого приложения, для которого требуется регистрация Azure AD. 

**Решение**   
При появлении запроса пользователь должен указать пароль устройства для входа в Azure AD. Возможны следующие значения.
- **Deny** — не выполнять вход и не использовать приложение.
- **Разрешить** — однократный вход в систему. При следующем открытии приложения появится запрос на вход.
- **Всегда разрешать** — учетные данные для входа кэшируются для приложения. При следующем запуске приложения запрос на вход не запрашивается.  

Если выбрать *всегда разрешать* для одного приложения, это приложение будет утверждено только для будущего входа. Дополнительные приложения запрашивают проверку подлинности до тех пор, пока они не будут установлены как *всегда разрешенные*. Кэшированные учетные данные для одного приложения не могут использоваться другим приложением.  

### <a name="devices-fail-to-register"></a>Не удается зарегистрировать устройства  

Существует несколько распространенных причин, по которым устройства Mac не регистрируются.  

#### <a name="cause-1"></a>Причина 1  

**Приложение Jamf Pro Enterprise в Azure имеет неверное разрешение или имеет более одного разрешения**  

  При создании приложения в Azure необходимо удалить все разрешения API по умолчанию, а затем назначить Intune одно разрешение *update_device_attributes*. 

  **Решение**  
  Проверьте и при необходимости исправьте разрешения для приложения Jamf, созданного в Azure AD. См. процедуру [создания приложения для Jamf в Azure AD](conditional-access-integrate-jamf.md#create-an-application-in-azure-active-directory). 

#### <a name="cause-2"></a>Причина 2  

**Приложение **Jamf Native MacOS Connector** не было создано в клиенте Azure AD, или согласие для соединителя подписано учетной записью, которая не имеет прав глобального администратора**  

  **Решение**  
  См. раздел *Настройка интеграции с MacOS Intune* статьи [Интеграция с Microsoft Intune](https://docs.jamf.com/10.13.0/jamf-pro/administrator-guide/Integrating_with_Microsoft_Intune.html) на docs.jamf.com. 

#### <a name="cause-3"></a>Причина 3

**У пользователя нет допустимой лицензии Intune или Jamf**  

  Отсутствие допустимой лицензии может привести к возникновению следующей ошибки, которая указывает на то, что срок действия лицензии Jamf истек:  
  ```
    Unable to connect to Microsoft Intune.  
    
    Check your Microsoft Intune Integration configuration.
  ```  

  **Решение**
  - Лицензия Jamf. обратитесь в Jamf, чтобы получить помощь по получению новой лицензии для Jamf.  
  - Лицензия Intune. Назначьте пользователю действительную лицензию или обратитесь в корпорацию Майкрософт или к своему партнеру за информацией о том, как получить текущую лицензию.

#### <a name="cause-4"></a>Причина 4  

**Пользователь не использовал *Jamf Self Service* для запуска приложения корпоративный портал**

Чтобы зарегистрировать устройство для успешной регистрации и регистрации в Intune через Jamf, пользователь должен использовать Jamf Self Service, чтобы открыть Корпоративный портал Intune. Если пользователь откроет корпоративный портал вручную, устройство будет регистрироваться и регистрироваться без подключения к Jamf.  

Чтобы определить, какую службу устройство использовало для регистрации и регистрации, просмотрите приложение корпоративный портал на устройстве. При регистрации через Jamf вы получите уведомление, чтобы открыть приложение самообслуживания для внесения изменений.

В корпоративный портал приложении пользователь может видеть **`Not registered`** и запись, аналогичная приведенной ниже, может появиться в журналах корпоративный портал:  

```
   Line 7783: <DATE> <IP ADDRESS> INFO com.microsoft.ssp.application TID=1  
 
   WelcomeViewController.swift: 253 (startLogin()) Portal launched without WPJ only arg while account is under partner management
```

**Решение**  
Чтобы изменить источник регистрации с Intune на Jamf, сделайте следующее:
1. [Отмените регистрацию устройства с macOS в Intune](https://docs.microsoft.com/intune-user-help/unenroll-your-device-from-intune-macos). Чтобы избежать дополнительных осложнений для устройств, которые не полностью удалены из Intune, см. [*причину 6*](#cause-6) в этом списке причин.  

2. На устройстве используйте Jamf Self Service, чтобы открыть приложение корпоративный портал, а затем зарегистрируйте устройство в Intune. Для этой задачи необходимо [использовать Jamf для развертывания приложения корпоративный портал для macOS](conditional-access-assign-jamf.md#deploy-the-company-portal-app-for-macos-in-jamf-pro)и [создания политики в Jamf Pro, которая регистрирует устройство пользователей в Azure AD](conditional-access-assign-jamf.md#create-a-policy-in-jamf-pro-to-have-users-register-their-devices-with-azure-active-directory).  

3. При открытии портала на первом экране появится запрос на вход. Использование рабочей или учебной учетной записи  

4. Корпоративный портал проверяет сведения об учетной записи, а затем показывает сведения о состояниях регистрации устройства и соответствия устройства. Желтыми треугольниками выделены действия, которые необходимо выполнить для защиты служебного устройства с macOS. Нажмите кнопку "Начать", чтобы начать регистрацию.  

5. При появлении соответствующего запроса введите сведения для входа с вашего компьютера.  
     
Регистрация устройства в службе управления может занять несколько минут. В течение этого времени вы можете выполнять на устройстве другие действия. После завершения настройки доступа к ресурсам организации появится соответствующее сообщение.

#### <a name="cause-5"></a>Причина 5  

**Интеграция с Intune отключена**

Если интеграция с Intune отключена, при попытке регистрации устройства пользователи получают всплывающее окно в корпоративный портал со следующим сообщением:  

```
   Invalid command line input
   
   Registration-only command line flag (-r) can only be used when partner management is enabled in Intune. Please contact your IT admin.
```  

Сервер Jamf Pro отправляет пульс на серверы Intune при выключении интеграции, сообщающей Intune о том, что интеграция отключена. 

**Решение**  
Повторно включите интеграцию с Intune в Jamf Pro. См. статью [Настройка интеграции Microsoft Intune в Jamf Pro](conditional-access-integrate-jamf.md#enable-intune-to-integrate-with-jamf-pro).


#### <a name="cause-6"></a>Причина 6  

**Устройство ранее было зарегистрировано в Intune, или пользователь попытался зарегистрировать устройство несколько раз.**

Если устройство отменяет регистрацию из Jamf, но некорректно удалено из Intune, или выполняется несколько попыток регистрации, на портале может появиться несколько экземпляров одного устройства. Это приводит к сбою регистрации Jamf.

**Решение**  
1. На компьютере Mac запустите **терминал**.
2. Выполните команду **sudo JAMF ремовемдмпрофиле**.
3. Выполните команду **sudo JAMF ремовефрамеворк**.
4. На сервере JAMF Pro удалите запись инвентаризации компьютера.
5. Удалите устройство из AzureAD.
6. Удалите следующие файлы на устройстве, если они существуют:
   - Поддержка/Library/Application Support/com. Microsoft. CompanyPortal. UserContext. info
   - Поддержка/Library/Application Support/com. Microsoft. CompanyPortal
   - /Library/Application Support support/com. жамфсофтваре. сайтов самообслуживания. Mac
   - Приложение/Либрари/савед
   - State/com. жамфсофтваре. сайтов самообслуживания. Mac. savedState получит
   - /Либрари/савед (состояние приложения)/com. Microsoft. CompanyPortal. savedState получит
   - /либрари/преференцес/ком.микрософт.компанипортал.плист
   - /либрари/преференцес/ком.жамфсофтваре.селфсервице.мак.плист
   - /либрари/преференцес/ком.жамфсофтваре.манажемент.жамфаад.плист
   - /Users/<username>/Либрари/кукиес/ком.Микрософт.компанипортал.бинарикукиес
   - /Users/<username>/Либрари/кукиес/ком.жамф.манажемент.жамфаад.бинарикукиес
   - com. Microsoft. CompanyPortal
   - com. Microsoft. CompanyPortal. Хоккэйсдк
   - enterpriseregistration.windows.net
   - https://device.login.microsoftonline.com
   - https://device.login.microsoftonline.com/
   - Ключ транспорта сеанса Microsoft (открытый и закрытый ключи)
   - Ключ Microsoft Workplace Join (открытый и закрытый ключи)
7. Удалите все данные из цепочки ключей на устройстве, которое ссылается на *Microsoft*, *Intune*или *Корпоративный портал*, включая сертификаты DeviceLogin.Microsoft.com. Удалите ссылки *JAMF* , за исключением открытого и закрытого ключей JAMF. 
   > [!IMPORTANT]  
   > Удаление открытого и закрытого ключей приведет к прерыванию регистрации устройства.

8. Удалите следующие записи, которые вы нашли:  
   - Тип: пароль приложения; Учетная запись: com. Microsoft. воркплацежоин. Thumbprint
   - Тип: пароль приложения; Учетная запись: com. Microsoft. воркплацежоин. РегистередусерпринЦипалнаме
   - Тип: сертификат; Кем выдан: MS-организации-доступ
   - Тип: Выбор удостоверения; Имя (URL-адрес ADFS STS, если он есть): https://adfs\<DNSName>.com/adfs/ls
   - Тип: Выбор удостоверения; Имя: https://enterpriseregistration.windows.net
   - Тип: Выбор удостоверения; Имя: https://enterpriseregistration.windows.net/  
9. Перезагрузите устройство Mac.
10. Удалите корпоративный портал с устройства.
11. Перейдите по адресу portal.manage.microsoft.com и удалите все экземпляры устройства Mac. Подождите по крайней мере 30 минут, прежде чем перейти к следующему шагу.
12. Повторно зарегистрируйте устройство в JAMF Pro.
13. Повторно откройте самостоятельную службу и запустите политику регистрации.


#### <a name="cause-7"></a>Причина 7  

**Жамфаад запрашивает доступ к разделу "Microsoft Workplace Join Key" из цепочки пользователей.**

Во время регистрации пользователь устройства macOS получает следующее приглашение, чтобы разрешить Жамфаад доступ к ключу из цепочки ключей: 

```
   JamfAAD wants to access key “Microsoft Workplace Join Key" in your keychain. 
    
   To allow this, enter the “login” keychain password
```

**Решение**  
Для успешной регистрации устройства в Azure AD Jamf необходимо предоставить пользователю пароль учетной записи и нажать кнопку **Разрешить**.

Этот запрос аналогичен запросу [устройств Mac при входе в цепочку ключей при открытии приложения](#mac-devices-prompt-for-keychain-sign-in-when-you-open-an-app), ранее в этой статье.  

 
### <a name="mac-device-shows-compliant-in-intune-but-noncompliant-in-azure"></a>Устройство Mac соответствует требованиям в Intune, но не соответствует в Azure  

**Причина**. следующие условия могут привести к тому, что устройство будет отображаться как совместимое в Intune, но не соответствует требованиям в Azure:  
- Устройство не зарегистрировано должным образом.  
- Устройство было зарегистрировано несколько раз без необходимой очистки.

**Решение**  
Чтобы устранить эту проблему, следуйте указаниям по устранению ошибки [*6*](#cause-6) для *устройств, которые не удается зарегистрировать*, ранее в этой статье. 


### <a name="duplicate-entries-appear-in-the-intune-console-for-mac-devices-enrolled-by-using-jamf"></a>В консоли Intune для устройств Mac, зарегистрированных с помощью Jamf, отображаются дублирующиеся записи  
 
**Причина**: устройство зарегистрировано в Intune несколько раз, как правило, повторно регистрируется после удаления из Intune.  

Когда устройство удаляется из Intune и Jamf Pro Integration, некоторые данные могут быть оставлены, что может привести к появлению последовательных регистраций для создания повторяющихся записей.  

**Решение**  
Чтобы устранить эту проблему, следуйте указаниям по устранению ошибки [*6*](#cause-6) для *устройств, которые не удается зарегистрировать*, ранее в этой статье. 

### <a name="compliance-policy-fails-to-evaluate-the-device"></a>Политике соответствия не удалось оценить устройство  

**Причина**. Интеграция Jamf с Intune не поддерживает политику соответствия требованиям, ориентированную на группы устройств. 

**Решение**  
Измените политику соответствия для устройств macOS, чтобы они были назначены группам пользователей. 


### <a name="could-not-retrieve-the-access-token-for-microsoft-graph-api"></a>Не удалось получить маркер доступа для Microsoft Graph API

Вы получили следующую ошибку:

```
   Could not retrieve the access token for Microsoft Graph API. Check the configuration for Microsoft Intune Integration.
```   

Источником этой ошибки может быть одна из следующих причин. 

#### <a name="theres-a-permission-issue-with-the-jamf-pro-application-in-azure"></a>У приложения Jamf Pro в Azure есть проблемы с разрешениями

При регистрации приложения Jamf Pro в Azure возникло одно из следующих условий.  
- Приложение получило более одного разрешения.
- Не выбран параметр **предоставить согласие администратора для *\<your компании >***  .  

**Решение**  
См. раздел Устранение причины ошибки 1 для [устройств, которые не удается зарегистрировать](#devices-fail-to-register)ранее в этой статье.

#### <a name="a-license-required-for-jamf-intune-integration-has-expired"></a>Срок действия лицензии, необходимой для интеграции Jamf-Intune, истек

**Решение**. см. раздел Устранение причины ошибки 3 для [регистрации устройств](#devices-fail-to-register). 

#### <a name="the-required-ports-arent-open-on-your-network"></a>Требуемые порты не открыты в вашей сети

**Решение**. Проверьте сведения о сетевых портах в [предварительных требованиях](conditional-access-integrate-jamf.md#prerequisites) для интеграции Jamf Pro с Intune.


## <a name="next-steps"></a>Дальнейшие шаги
Дополнительные сведения об [интеграции Jamf Pro с Intune](conditional-access-integrate-jamf.md)