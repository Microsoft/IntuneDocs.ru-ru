---
title: Добавление скриптов PowerShell в Microsoft Intune для устройств Windows 10 — Azure | Документы Майкрософт
description: Добавьте скрипты PowerShell, назначьте политику скриптов группам Azure Active Directory, используйте отчеты для отслеживания скриптов и ознакомьтесь с инструкциями по удалению скриптов, добавленных на устройствах Windows 10 в Microsoft Intune. Изучите распространенные проблемы и способы их устранения.
keywords: ''
author: MandiOhlinger
ms.author: mandia
manager: dougeby
ms.date: 12/03/2018
ms.topic: article
ms.prod: ''
ms.service: microsoft-intune
ms.technology: ''
ms.assetid: 768b6f08-3eff-4551-b139-095b3cfd1f89
ms.reviewer: ''
ms.suite: ems
search.appverid: MET150
ms.custom: intune-azure
ms.openlocfilehash: 063a5cbbe18efc5c406c9dc7f2fa40d614b2e48a
ms.sourcegitcommit: d3b1e3fffd3e0229292768c7ef634be71e4736ae
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2018
ms.locfileid: "52860968"
---
# <a name="manage-powershell-scripts-in-intune-for-windows-10-devices"></a>Управление сценариями PowerShell в Intune для устройств Windows 10

Используйте расширение управления Intune, чтобы отправить скрипты PowerShell в Intune для выполнения на устройствах Windows 10. Расширение управления предоставляет больше возможностей управления мобильными устройствами (MDM) Windows 10 и упрощает переход на современные средства управления.

## <a name="moving-to-modern-management"></a>Переход на современные принципы управления

Вычислительная среда конечного пользователя находится на этапе цифрового преобразования. Классические ИТ-системы работают по схеме, где используется одна платформа для устройств, применяются корпоративные устройства, пользователи занимаются своими обязанностями в офисе, а множество ИТ-процессов выполняется вручную и в реактивном режиме. Современные организации используют сразу несколько платформ как на личных, так и на корпоративных устройствах, позволяют пользователям работать из любого места, а также поддерживают автоматизированные и упреждающие ИТ-процессы.

Службы управления мобильными устройствами, например Microsoft Intune, могут контролировать работу мобильных и настольных устройств под управлением Windows 10. Встроенный клиент управления Windows 10 взаимодействует с Intune для реализации соответствующих задач на уровне предприятия. Вам могут потребоваться некоторые задачи, например, расширенная настройка устройств, устранение неполадок и управление устаревшими приложениями Win32, которые сейчас недоступны в Windows 10 MDM. Для их выполнения можно запустить программный клиент Intune на устройствах Windows 10. Дополнительные сведения см. в [сравнении возможностей управления ПК Windows как компьютерами или мобильными устройствами](pc-management-comparison.md).

Расширение управления Intune дополняет встроенные возможности Windows 10 MDM. Вы можете создать скрипты PowerShell для выполнения на устройствах Windows 10. Например, создайте скрипт PowerShell для установки устаревшего приложения Win32, отправьте его в Intune, назначьте скрипт группе Azure Active Directory (AD) и запустите его. Вы сможете отслеживать состояние выполнения скрипта от начала до конца.

## <a name="prerequisites"></a>Предварительные условия

Для расширения управления Intune требуется выполнить следующие условия:

- Устройства должны быть присоединены к AAD и настроены на [автоматическую регистрацию](windows-enroll.md#enable-windows-10-automatic-enrollment). Расширение управления Intune поддерживает устройства Windows, зарегистрированные в AAD или гибридном домене, а также совместно управляемые устройства. Устройства, зарегистрированные в объекте групповой политики, не поддерживаются.
- Устройства должны работать под управлением Windows 10 версии 1607 или более поздней.
- Агент расширения управления Intune устанавливается при развертывании скрипта PowerShell или приложения Win32 для пользователя или группы безопасности устройств.

## <a name="create-a-powershell-script-policy"></a>Создание политики сценария PowerShell 

1. На [портале Azure](https://portal.azure.com) выберите **Все службы**, отфильтруйте список по **Intune** и выберите **Microsoft Intune**.
2. Выберите **Конфигурация устройства** > **Скрипты PowerShell** > **Добавить**.
3. Введите **имя** и **описание** скрипта PowerShell. В поле **Расположение скрипта** укажите скрипт PowerShell. Размер скрипта не должен превышать 200 КБ (ASCII) или 100 КБ (Юникод).
4. Выберите **Настройка**. Затем решите, следует ли выполнять скрипт с учетными данными пользователя на устройстве (**Да**) или в контексте системы (**Нет**). По умолчанию сценарий выполняется в контексте системы. Выберите **Да**, если сценарий не требуется запускать в контексте системы. 
  ![Панель добавления сценария PowerShell](./media/mgmt-extension-add-script.png)
5. Выберите, должен ли скрипт быть подписан доверенным издателем (**Да**). По умолчанию требование к подписыванию сценария отсутствует. 
6. Нажмите кнопку **ОК**, а затем **Создать**, чтобы сохранить скрипт.

## <a name="assign-a-powershell-script-policy"></a>Назначение политики сценария PowerShell

1. В области **Скрипты PowerShell** выберите скрипт для назначения, а затем выберите пункты **Управление** > **Назначения**.

    ![Панель добавления скриптов PowerShell](./media/mgmt-extension-assignments.png)

2. Щелкните **Выбрать группы**, чтобы открыть список доступных групп Azure AD. 
3. Выберите одну или несколько групп пользователей, чьи устройства получат скрипт. Нажмите **Выбрать**, чтобы назначить политику выбранным группам.

> [!NOTE]
> - Сценарии PowerShell запрещено применять для групп компьютеров.
> - Конечным пользователям не требуется выполнять вход на устройство для выполнения скриптов PowerShell.
> - Скрипты PowerShell в Intune могут назначаться группам безопасности устройств AAD.

Клиент расширения управления Intune синхронизируется с Intune каждый час. После назначения политики группам Azure AD выполняется скрипт PowerShell, после чего выводятся результаты выполнения.

## <a name="monitor-run-status-for-powershell-scripts"></a>Отслеживание состояния выполнения сценариев PowerShell

На портале Azure можно отслеживать состояние выполнения сценариев PowerShell для пользователей и устройств.

В области **Скрипты PowerShell** выберите скрипт для отслеживания, а затем **Монитор** и один из следующих отчетов:

- **Состояние устройства**
- **Состояние пользователя**

## <a name="troubleshoot-powershell-scripts"></a>Устранение неполадок со скриптами PowerShell

Журналы агентов на клиентском компьютере обычно находятся в папке `\ProgramData\Microsoft\IntuneManagementExtension\Logs`. Для просмотра этих файлов журналов можно использовать [CMTrace.exe](https://docs.microsoft.com/sccm/core/support/tools). 

![Снимок экрана. Журналы агентов](./media/apps-win32-app-10.png)  

## <a name="delete-a-powershell-script"></a>Удаление скрипта PowerShell

В области **Скрипты PowerShell** щелкните скрипт правой кнопкой мыши и выберите пункт **Удалить**.

## <a name="common-issues-and-resolutions"></a>Распространенные проблемы и способы их устранения

Скрипты PowerShell не выполняются при каждом входе в систему. Они выполняются только после перезагрузки устройства или перезапуска **расширения управления Microsoft Intune**. Клиент расширения управления Intune раз в час проверяет наличие изменений в скриптах или политиках Intune.

#### <a name="issue-intune-management-extension-doesnt-download"></a>Проблема. Не удается скачать расширение управления Intune

**Возможные решения**:

- Убедитесь, что устройства автоматически регистрируются в AAD. Чтобы проверить это, выполните следующие действия на устройств:. 

  1. Откройте **Учетные записи** > **Учетные записи** > **Доступ к рабочей или учебной учетной записи**.
  2. Выберите присоединенную учетную запись и щелкните **Информация**.
  3. В разделе **Расширенный диагностический отчет** выберите **Создать отчет**.
  4. Откройте в браузере страницу `MDMDiagReport` и перейдите к разделу **Enrolled configuration sources** (Зарегистрированные источники конфигурации).
  5. Найдите свойство **MDMDeviceWithAAD**. Если такое свойство не существует, значит устройство не регистрируется автоматически.

    Выполните шаги, описанные в руководстве по [включению автоматической регистрации Windows 10](windows-enroll.md#enable-windows-10-automatic-enrollment).

#### <a name="issue-the-powershell-scripts-do-not-run"></a>Проблема. Скрипты PowerShell не выполняются

**Возможные решения**:

- Убедитесь, что расширение управления Intune скачано в папку `%ProgramFiles(x86)%\Microsoft Intune Management Extension`.
- Скрипты не выполняются в Surface Hub.
- Проверьте, есть ли ошибки в журналах в каталоге `\ProgramData\Microsoft\IntuneManagementExtension\Logs`.
- Чтобы исключить проблемы с разрешениями, задайте `Run this script using the logged on credentials` в свойствах скрипта PowerShell. Также убедитесь, что выполнивший вход пользователь имеет нужные разрешения на выполнение скрипта.
- Чтобы определить проблемы со скриптами, запустите пример скрипта. Например, создайте каталог `C:\Scripts` и предоставьте всем полный доступ к нему. Выполните следующий сценарий:

  ```powershell
  write-output "Script worked" | out-file c:\Scripts\output.txt
  ```

  При успешном выполнении будет создан файл output.txt с текстом Script worked (Скрипт выполнен).

- Чтобы проверить выполнение скриптов без Intune, запустите их в локальном контексте системы с помощью [средства psexec](https://docs.microsoft.com/sysinternals/downloads/psexec):

  `psexec -i -s`

## <a name="next-steps"></a>Дальнейшие шаги

[Мониторинг](device-profile-monitor.md) и [устранение неполадок](device-profile-troubleshoot.md) для профилей.
