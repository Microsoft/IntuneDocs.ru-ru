---
title: Добавление скриптов PowerShell для устройств Windows 10 в Microsoft Intune — Azure | Документация Майкрософт
description: Создавайте и добавляйте скрипты PowerShell, назначайте политику скриптов группам Azure Active Directory, используйте отчеты для отслеживания скриптов и ознакомьтесь с инструкциями по удалению скриптов, добавленных для устройств Windows 10 в Microsoft Intune. Изучите распространенные проблемы и способы их устранения.
keywords: ''
author: MandiOhlinger
ms.author: mandia
manager: dougeby
ms.date: 04/03/2019
ms.topic: conceptual
ms.prod: ''
ms.service: microsoft-intune
ms.localizationpriority: high
ms.technology: ''
ms.assetid: 768b6f08-3eff-4551-b139-095b3cfd1f89
ms.reviewer: ''
ms.suite: ems
search.appverid: MET150
ms.custom: intune-azure
ms.collection: M365-identity-device-management
ms.openlocfilehash: 66a23b75913f6465064a988bd8f2ba9c2b4c36d6
ms.sourcegitcommit: 143dade9125e7b5173ca2a3a902bcd6f4b14067f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61514145"
---
# <a name="use-powershell-scripts-on-windows-10-devices-in-intune"></a>Использование скриптов PowerShell для устройств Windows 10 в Intune

Используйте расширение управления Microsoft Intune, чтобы отправлять скрипты PowerShell в Intune для выполнения на устройствах Windows 10. Расширение управления предоставляет больше возможностей управления мобильными устройствами (MDM) Windows 10 и упрощает переход на современные средства управления.

Данная функция применяется к:

- Windows 10 и более поздней версии

## <a name="move-to-modern-management"></a>Переход на современные принципы управления

Вычислительная среда конечного пользователя находится на этапе цифрового преобразования. Классические ИТ-системы работают по схеме, где используется одна платформа для устройств, применяются корпоративные устройства, пользователи занимаются своими обязанностями в офисе, а различные ИТ-процессы выполняются вручную и в оперативном режиме. Современные организации используют сразу несколько платформ как на личных, так и на корпоративных устройствах, позволяют пользователям работать из любого места, а также поддерживают автоматизированные и упреждающие ИТ-процессы.

Службы управления мобильными устройствами, например Microsoft Intune, могут контролировать работу мобильных и настольных устройств под управлением Windows 10. Встроенный клиент управления Windows 10 взаимодействует с Intune для реализации соответствующих задач на уровне предприятия. Возможно, вам потребуется выполнять такие задачи, как расширенная настройка или устранение неполадок. Вы можете управлять приложениями Win32 с помощью [соответствующей функции](apps-win32-app-management.md) на устройствах с Windows 10.

Расширение управления Intune дополняет встроенные возможности Windows 10 MDM. Вы можете создать скрипты PowerShell для выполнения на устройствах Windows 10. Например, создайте скрипт PowerShell для расширенной настройки устройств, отправьте его в Intune, назначьте скрипт группе Azure Active Directory (AD) и запустите его. Вы сможете отслеживать состояние выполнения скрипта от начала до конца.

## <a name="prerequisites"></a>Предварительные условия

Для расширения управления Intune требуется выполнить следующие условия:

- Устройства должны быть присоединены к службе Azure AD или зарегистрированы в ней, и в Azure AD и Intune должна быть настроена [автоматическая регистрация](quickstart-setup-auto-enrollment.md). Расширение управления Intune поддерживает устройства Windows, присоединенные к AAD, гибридному домену Azure AD, а также совместно управляемые зарегистрированные устройства Windows.
- Устройства должны работать под управлением Windows 10 версии 1607 или более поздней.
- Агент расширения управления Intune устанавливается при развертывании скрипта PowerShell или приложения Win32 для пользователя или группы безопасности устройств.

## <a name="create-a-script-policy"></a>Создание политики скрипта 

1. На [портале Azure](https://portal.azure.com) выберите **Все службы** > отфильтруйте список по **Intune** > выберите **Intune**.
2. Выберите **Конфигурация устройства** > **Скрипты PowerShell** > **Добавить**.
3. Укажите следующие свойства.
    - **Имя**. Введите имя скрипта PowerShell. 
    - **Описание** Введите описание скрипта PowerShell. Этот параметр является необязательным, но мы рекомендуем его использовать. 
    - **Расположение скрипта**. Укажите расположение скрипта PowerShell. Размер скрипта не должен превышать 200 КБ (ASCII).
4. Нажмите **Настроить** и укажите следующие свойства.
    - **Запускать сценарий по учетным данным**. Выберите **Да**, чтобы запускать скрипт с помощью учетных данных пользователя на устройстве. Выберите **Нет** (по умолчанию) для запуска скрипта в контексте системы. Многие администраторы выбирают **Да**. Выберите **Нет**, если скрипт требуется запускать в контексте системы.
    - **Принудительно проверить подпись сценария**. Выберите **Да**, если скрипт должен быть подписан доверенным издателем. Выберите **Нет** (по умолчанию), если требование к подписыванию скрипта отсутствует. 
    - **Запуск скрипта на 64-разрядном узле PowerShell**. Выберите **Да** для запуска скрипта на 64-разрядном узле PowerShell (PS) в 64-разрядной архитектуре клиента. Выберите **Нет** (по умолчанию) для запуска скрипта на 32-разрядном узле PowerShell.

      При выборе значения **Да** или **Нет** используйте следующую таблицу для нового и существующего поведения политики.

      | Запуск скрипта на 64-разрядном узле PS | Архитектура клиента | Новый скрипт PS | Существующий скрипт политики PS |
      | --- | --- | --- | --- | 
      | Нет | 32-разрядная система  | Поддерживается 32-разрядный узел PS | Скрипт запускается только на 32-разрядном узле PS, который работает в 32- и 64-разрядных архитектурах. |
      | Да | 64-разрядная система | Скрипт запускается на 64-разрядном узле PS для 64-разрядных архитектур. Если запуск выполнялся в 32-разрядной системе, скрипт запускается на 32-разрядном узле PS. | Скрипт запускается на 32-разрядном узле PS. При изменении значения этого параметра на 64-разрядную версию скрипт открывается (не запускается) на 64-разрядном узле PS и выводит результаты. Если запуск выполнялся в 32-разрядной системе, скрипт запускается на 32-разрядном узле PS. |

    ![Добавление и использование скрипов PowerShell в Microsoft Intune](./media/mgmt-extension-add-script.png)
5. Выберите **ОК** > **Создать**, чтобы сохранить скрипт.

## <a name="assign-the-policy"></a>Назначение политики

1. В области **Скрипты PowerShell** выберите скрипт для назначения, а затем выберите пункты **Управление** > **Назначения**.

    ![Назначение или развертывание скрипта PowerShell для групп устройств в Microsoft Intune](./media/mgmt-extension-assignments.png)

2. Щелкните **Выбрать группы**, чтобы открыть список доступных групп Azure AD. 
3. Выберите одну или несколько групп пользователей, чьи устройства получат скрипт. Нажмите **Выбрать**, чтобы назначить политику выбранным группам.

> [!NOTE]
> - Конечным пользователям не требуется выполнять вход на устройство для выполнения скриптов PowerShell.
> - Скрипты PowerShell в Intune могут назначаться группам безопасности устройств AAD.
> - Скрипты PowerShell в Intune могут назначаться группам безопасности пользователей Azure AD.

Клиент расширения управления Intune сверяется с Intune каждый час и после каждой перезагрузки, чтобы получить новые скрипты или изменения. После назначения политики группам Azure AD выполняется скрипт PowerShell, после чего выводятся результаты выполнения. Последующее выполнение скрипта происходит только при изменении скрипта или политики.

## <a name="monitor-run-status"></a>Отслеживание состояния выполнения

На портале Azure можно отслеживать состояние выполнения сценариев PowerShell для пользователей и устройств.

В области **Скрипты PowerShell** выберите скрипт для отслеживания, а затем **Монитор** и один из следующих отчетов:

- **Состояние устройства**
- **Состояние пользователя**

## <a name="troubleshoot-scripts"></a>Устранение неполадок, связанных со скриптами

Журналы агентов на клиентском компьютере обычно находятся в папке `\ProgramData\Microsoft\IntuneManagementExtension\Logs`. Для просмотра этих файлов журналов можно использовать [CMTrace.exe](https://docs.microsoft.com/sccm/core/support/tools). 

![Снимок экрана или пример журналов агента cmtrace в Microsoft Intune](./media/apps-win32-app-10.png)  

## <a name="delete-a-script"></a>Удаление скрипта

В области **Скрипты PowerShell** щелкните скрипт правой кнопкой мыши и выберите пункт **Удалить**.

## <a name="common-issues-and-resolutions"></a>Распространенные проблемы и способы их устранения

Скрипты PowerShell не выполняются при каждом входе в систему. Они выполняются только после перезагрузки устройства или перезапуска **расширения управления Microsoft Intune**. Клиент расширения управления Intune раз в час проверяет наличие изменений в скриптах или политиках Intune.

#### <a name="issue-intune-management-extension-doesnt-download"></a>Проблема. Не удается скачать расширение управления Intune

**Возможные решения**:

- Убедитесь, что устройства автоматически регистрируются в AAD. Чтобы проверить это, выполните следующие действия на устройств:. 

  1. Откройте **Учетные записи** > **Учетные записи** > **Доступ к рабочей или учебной учетной записи**.
  2. Выберите присоединенную учетную запись и щелкните **Информация**.
  3. В разделе **Расширенный диагностический отчет** выберите **Создать отчет**.
  4. Откройте в браузере страницу `MDMDiagReport` и перейдите к разделу **Enrolled configuration sources** (Зарегистрированные источники конфигурации).
  5. Найдите свойство **MDMDeviceWithAAD**. Если такое свойство не существует, значит устройство не регистрируется автоматически.

    Выполните шаги, описанные в руководстве по [включению автоматической регистрации Windows 10](windows-enroll.md#enable-windows-10-automatic-enrollment).

#### <a name="issue-powershell-scripts-do-not-run"></a>Проблема. Скрипты PowerShell не выполняются

**Возможные решения**:

- Убедитесь, что расширение управления Intune скачано в папку `%ProgramFiles(x86)%\Microsoft Intune Management Extension`.
- Скрипты не выполняются в Surface Hub.
- Проверьте, есть ли ошибки в журналах в каталоге `\ProgramData\Microsoft\IntuneManagementExtension\Logs`.
- Чтобы исключить проблемы с разрешениями, задайте `Run this script using the logged on credentials` в свойствах скрипта PowerShell. Также убедитесь, что выполнивший вход пользователь имеет нужные разрешения на выполнение скрипта.
- Чтобы определить проблемы со скриптами, запустите пример скрипта. Например, создайте каталог `C:\Scripts` и предоставьте всем полный доступ к нему. Выполните следующий сценарий:

  ```powershell
  write-output "Script worked" | out-file c:\Scripts\output.txt
  ```

  При успешном выполнении будет создан файл output.txt с текстом Script worked (Скрипт выполнен).

- Чтобы проверить выполнение скриптов без Intune, запустите их в локальном контексте системы с помощью [средства psexec](https://docs.microsoft.com/sysinternals/downloads/psexec):

  `psexec -i -s`

## <a name="next-steps"></a>Дальнейшие шаги

[Мониторинг](device-profile-monitor.md) и [устранение неполадок](device-profile-troubleshoot.md) для профилей.
