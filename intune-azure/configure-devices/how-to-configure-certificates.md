---
title: "Настройка сертификатов с помощью Intune"
titleSuffix: Intune Azure preview
description: "Предварительная версия Intune Azure. Узнайте, как использовать Intune для создания и назначения сертификатов, которые помогают защитить подключения Wi-Fi, VPN и другие подключения."
keywords: 
author: robstackmsft
ms.author: robstack
manager: angrobe
ms.date: 02/15/2017
ms.topic: article
ms.prod: 
ms.service: microsoft-intune
ms.technology: 
ms.assetid: 5eccfa11-52ab-49eb-afef-a185b4dccde1
ms.reviewer: heenamac
ms.suite: ems
ms.custom: intune-azure
translationtype: Human Translation
ms.sourcegitcommit: b4d095506215b775d56d172e9aabae1737757310
ms.openlocfilehash: 364534ad788466f8b268b4091decee5326b94163
ms.lasthandoff: 02/16/2017


---

# <a name="how-to-configure-certificates-in-microsoft-intune"></a>Настройка сертификатов в Microsoft Intune

[!INCLUDE[azure_preview](../includes/azure_preview.md)]

При предоставлении пользователям доступа к корпоративным ресурсам через профили VPN, Wi-Fi или электронной почты можно обеспечить безопасность доступа, установив сертификат на каждом устройстве. Высокоуровневый рабочий процесс имеет следующий вид:

1. Убедитесь в наличии правильной инфраструктуры сертификатов. Вы можете использовать [сертификаты SCEP](configure-certificate-infrastructure-for-scep.md) и [сертификаты PKCS](configure-certificate-infrastructure-for-pfx.md).
2. Установите корневой сертификат (или промежуточный сертификат центра сертификации (ЦС)) на каждом устройстве, чтобы оно распознавало подлинность вашего ЦС. Для этого создайте и назначьте **профиль доверенного сертификата**. При его назначении устройства, которыми вы управляете с помощью Intune, запрашивают и получают корневой сертификат. Необходимо создать отдельный профиль для каждой платформы. Профиль доверенного сертификата доступен для следующих платформ:
    - Устройства iOS 8.0 и более поздней версии
    - устройства macOS 10.9 и более поздней версии;
    - Android 4.0 и более поздней версии <!--Android for Work --->;
    - Windows 8.1 и более поздние версии
    - Windows Phone 8.1 и более поздней версии
    - Windows 10 и более поздней версии
3. Создайте профили сертификатов, чтобы устройства запрашивали сертификат, используемый для проверки подлинности доступа к VPN, Wi-Fi и электронной почте. Вы можете создать и развернуть профиль сертификата **PKCS** или **SCEP** для устройств на следующих платформах:
    - Устройства iOS 8.0 и более поздней версии
    - Android 4.0 и более поздней версии
    - Android for Work
    - Windows 10 (Desktop и Mobile) и более поздних версий

    Профиль сертификата SCEP можно использовать только на следующих платформах:

-     устройства macOS 10.9 и более поздней версии;
-     Windows Phone 8.1 и более поздней версии

Необходимо создать отдельный профиль для каждой платформы устройства. При создании профиля необходимо сопоставить его с уже созданным профилем доверенного корневого сертификата.

### <a name="further-considerations"></a>Дополнительные вопросы

- При отсутствии центра сертификации предприятия необходимо создать его.
- Если в зависимости от платформ устройств вы решите использовать профиль SCEP, необходимо также настроить сервер службы регистрации сертификатов для сетевых устройств (NDES).
- Если вы планируете использовать профили SCEP или PKCS, необходимо скачать и настроить соединитель сертификатов Microsoft Intune.

## <a name="before-you-start"></a>Перед началом работы


### <a name="if-you-want-to-use-scep-certificates"></a>Если необходимо использовать сертификаты SCEP

Выполните необходимые предварительные требования, приведенные в статье [Certificate infrastructure for SCEP](/intune-azure/configure-devices/configure-certificate-infrastructure-for-scep) (Инфраструктура сертификатов для SCEP).

### <a name="if-you-want-to-use-pkcs-certificates"></a>Если необходимо использовать сертификаты PKCS

Выполните необходимые предварительные требования, приведенные в статье [Certificate infrastructure for PKCS](/intune-azure/configure-devices/configure-certificate-infrastructure-for-pfx) (Инфраструктура сертификатов для PKCS).

## <a name="task-1-export-the-trusted-root-ca-certificate"></a>Задача 1. Экспорт доверенного корневого сертификата ЦС
Экспортируйте доверенный корневой сертификат центра сертификации (ЦС) в виде **CER**-файла из выдающего ЦС или с любого устройства, доверяющего выдающему ЦС. Не экспортируйте закрытый ключ.

Сертификат будет импортирован при настройке профиля доверенного сертификата.

## <a name="task-2-create-trusted-certificate-profiles"></a>Задача 2. Создание профилей доверенных сертификатов
Перед созданием профиля сертификата SCEP или PKCS необходимо создать профиль доверенного сертификата. Профиль доверенного сертификата и профиль SCEP или PKCS требуются для каждой платформы устройств.

### <a name="to-create-a-trusted-certificate-profile"></a>Создание профиля доверенного сертификата

1. Зарегистрируйтесь на портале Azure.
2. Выберите **Больше служб** > **Другое** > **Intune**.
3. В колонке **Intune** выберите **Настройка устройств**.
2. В колонке **Конфигурация устройства** выберите **Управление** > **Профили**.
3. В колонке профилей выберите **Создание профиля**.
4. В колонке **Создать профиль** в соответствующих полях введите **Имя** и **Описание** для профиля доверенного сертификата.
5. Из раскрывающегося списка **Платформа** выберите платформу устройств для этого доверенного сертификата. Сейчас для параметров ограничения устройства можно выбрать одну из следующих платформ:
    - **Android**
    - **iOS**
    - **macOS**
    - **Windows Phone 8.1**
    - **Windows 8.1 и более поздние версии**
    - **Windows 10 и более поздние версии**.
6. Из раскрывающегося списка **Профиль** выберите **Доверенный сертификат**.
7. Найдите сертификат, сохраненный при выполнении задачи 1, а затем нажмите кнопку **ОК**.
8. Только для устройств Windows 8.1 и Windows 10 выберите **Конечное хранилище** для доверенного сертификата из следующих расположений:
    - **хранилище сертификатов на компьютере — корневое**;
    - **хранилище сертификатов на компьютере — промежуточное**;
    - **хранилище сертификатов пользователей — промежуточное**.
8. По завершении нажмите кнопку **ОК**, вернитесь в колонку **Создание профиля** и выберите **Создать**.

Созданный профиль отобразится в колонке со списком профилей.
Сведения о том, как назначить этот профиль группам, см. в статье о [назначении профилей устройствам](how-to-assign-device-profiles.md).


> [!Note]
> На устройствах Android будет выводиться уведомление о том, что третья сторона установила доверенный сертификат.

## <a name="task-3-create-scep-or-pkcs-certificate-profiles"></a>Задача 3. Создание профилей сертификатов SCEP или PKCS
После создания профиля доверенного сертификата создайте профили сертификатов SCEP или PKCS для каждой платформы, которую хотите использовать. При создании профиля сертификата SCEP необходимо указать профиль доверенного сертификата для этой же платформы. Это свяжет два профиля сертификатов, но каждый профиль необходимо по-прежнему назначать отдельно.

### <a name="to-create-an-scep-certificate-profile"></a>Создание профиля сертификата SCEP

1. На портале Azure выберите рабочую нагрузку **Настройка устройств**.
2. В колонке **Конфигурация устройства** выберите **Управление** > **Профили**.
3. В колонке профилей выберите **Создание профиля**.
4. В колонке **Создать профиль** в соответствующих полях введите **Имя** и **Описание** для профиля сертификата SCEP.
5. Из раскрывающегося списка **Платформа** выберите платформу устройств для этого сертификата SCEP. Сейчас для параметров ограничения устройства можно выбрать одну из следующих платформ:
    - **Android**
    - **iOS**
    - **macOS**
    - **Windows Phone 8.1**
    - **Windows 8.1 и более поздние версии**
    - **Windows 10 и более поздние версии**.
6. Из раскрывающегося списка **Профиль** выберите **Сертификат SCEP**.
7. В колонке **Сертификат SCEP** настройте следующие параметры:
    - **Срок действия сертификата.** Запустив на выдающем ЦС команду **certutil - setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE**, которая позволяет использовать настраиваемый срок действия, вы можете указать оставшееся время до истечения срока действия сертификата.<br>Можно указать значение, ниже, но не выше периода действия в указанном шаблоне сертификата. Например, если в шаблоне сертификата указан срок действия сертификата в два года, можно указать значение в один год, но не в пять лет. Кроме того, значение не должно превышать значение оставшегося периода действия сертификата, выдаваемого центром сертификации. 
    - **Поставщик хранилища ключей (KSP)** (Windows Phone 8.1, Windows 8.1, Windows 10). Укажите, где будет храниться ключ для сертификата. Выберите одно из следующих значений:
        - **Зарегистрировать в KSP доверенного платформенного модуля (TPM) при его наличии, в противном случае зарегистрировать в KSP программного обеспечения**.
        - **Зарегистрировать в KSP доверенного платформенного модуля (TPM), в противном случае создать сбой**.
        - **Зарегистрировать в паспорте, в противном случае создать сбой (Windows 10 и более поздних версий)**.
        - **Зарегистрировать в KSP программного обеспечения**.
    - **Формат имени субъекта.** Выберите в списке способ, с помощью которого Intune автоматически создает имя субъекта в запросе на сертификат. Если сертификат предназначен для пользователя, в имя субъекта можно также включить адрес электронной почты пользователя. Выберите один из следующих типов.
        - **Не настроено**.
        - **Обычное имя**.
        - **Обычное имя с адресом электронной почты**.
        - **Обычное имя как адрес электронной почты**.
    - **Альтернативное имя субъекта.** Укажите способ, с помощью которого Intune автоматически создает значения для альтернативного имени субъекта в запросе на сертификат. Например, если вы выбрали тип сертификата пользователя, в альтернативное имя субъекта можно включить имя участника-пользователя. Если сертификат клиента будет использоваться для проверки подлинности сервера политики сети, в качестве альтернативного имени субъекта необходимо задать имя участника-пользователя. 
    - **Использование ключа.** Укажите параметры использования ключа для сертификата. Можно выбрать один из следующих вариантов. 
        - **Шифрование ключей.** Обмен ключами разрешается, только если они зашифрованы. 
        - **Цифровая подпись.** Обмен ключами разрешается, только если они защищены с помощью цифровой подписи. 
    - **Размер ключа (разрядов).** Выберите количество битов, которое будет содержаться в ключе. 
    - **Хэш-алгоритм** (Android, Windows Phone 8.1, Windows 8.1, Windows 10). Используйте с этим сертификатом один из доступных типов хэш-алгоритмов. Выберите максимальный уровень безопасности, который поддерживают подключающиеся устройства. 
    - **Корневой сертификат.** Выберите профиль корневого сертификата ЦС, настроенный ранее и назначенный пользователю или устройству. Этот сертификат ЦС должен быть корневым сертификатом ЦС, который выдаст сертификат, настраиваемый в данном профиле сертификата. 
    - **Расширенное использование ключа.** Выберите **Добавить**, чтобы добавить значения для назначения сертификата. В большинстве случаев для сертификата потребуется **Проверка подлинности клиента** , чтобы пользователь или устройство могли выполнить проверку подлинности на сервере. Однако при необходимости можно добавить любые другие варианты использования ключа. 
    - **Параметры регистрации**
        - **Renewal threshold (%)** (Порог обновления (%)). Укажите процент времени существования сертификата, который остается, прежде чем устройство запросит его возобновление.
        - **URL-адреса сервера SCEP.** Укажите один или несколько URL-адресов для серверов NDES, которые будут выдавать сертификаты через SCEP. 
8. По завершении вернитесь в колонку **Создание профиля** и щелкните **Создать**.

Созданный профиль отобразится в колонке со списком профилей.

Чтобы настроить параметры профиля сертификата SCEP, следуйте инструкциям на странице настройки профиля.
>[!Note]
> Только для устройств iOS: чтобы указать настраиваемый формат имени субъекта, в области "Формат имени субъекта" укажите Custom (Настраиваемый).
> В настоящее время для настраиваемого формата можно выбрать одну из двух переменных: **Обычное имя (CN)** или **Электронная почта (E)**. Используя сочетание этих переменных и статических строк, можно создать настраиваемый формат имени субъекта, как показано ниже: **CN={{UserName}},E={{EmailAddress}},OU=Mobile,O=Finance Group,L=Redmond,ST=Washington,C=US**. В этом примере создается формат имени субъекта, в котором для значений "Подразделение", "Организация", "Расположение", "Состояние" и "Страна" помимо переменных CN и E используются строки. [В этой статье](https://msdn.microsoft.com/library/windows/desktop/aa377160.aspx) описывается функция **CertStrToName** и ее поддерживаемые строки.


### <a name="to-create-a-pkcs-certificate-profile"></a>Создание профиля сертификата PKCS

На портале Azure выберите рабочую нагрузку **Настройка устройств**.
2. В колонке **Конфигурация устройства** выберите **Управление** > **Профили**.
3. В колонке профилей выберите **Создать профиль**.
4. В колонке **Создать профиль** в соответствующих полях введите **Имя** и **Описание** для профиля сертификата PKCS.
5. Из раскрывающегося списка **Платформа** выберите платформу устройств для этого сертификата PKCS:
    - **Android**
    - **iOS**
    - **Windows 10 и более поздние версии**.
6. Из раскрывающегося списка **Профиль** выберите **Сертификат PKCS**.
7. В колонке **Сертификат PKCS** настройте следующие параметры:
    - **Renewal threshold (%)** (Порог обновления (%)). Укажите процент времени существования сертификата, который остается, прежде чем устройство запросит его возобновление.
    - **Срок действия сертификата.** Запустив на выдающем ЦС команду **certutil - setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE**, которая позволяет использовать настраиваемый срок действия, вы можете указать оставшееся время до истечения срока действия сертификата.<br>Можно указать значение, ниже, но не выше периода действия в указанном шаблоне сертификата. Например, если в шаблоне сертификата указан срок действия сертификата в два года, можно указать значение в один год, но не в пять лет. Кроме того, значение не должно превышать значение оставшегося периода действия сертификата, выдаваемого центром сертификации.
    - **Поставщик хранилища ключей (KSP)** (Windows 10).
    - **Центр сертификации** -.
    - **Имя центра сертификации** -.
    - **Имя шаблона сертификата.** Введите имя шаблона сертификата, для использования которого настроена служба регистрации сертификатов для сетевых устройств и который добавлен в выдающий ЦС.
    Убедитесь, что оно в точности совпадает с именем одного из шаблонов сертификатов, перечисленных в реестре сервера, на котором запущена служба регистрации сертификатов для сетевых устройств. Убедитесь, что вы ввели имя шаблона сертификата, а не отображаемое имя шаблона сертификата. 
    Чтобы найти имена шаблонов сертификатов, перейдите к следующему разделу реестра: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MSCEP. Вы увидите шаблоны сертификатов, перечисленные в виде значений для параметров **EncryptionTemplate**, **GeneralPurposeTemplate**и **SignatureTemplate**. По умолчанию для всех трех шаблонов сертификатов используется значение IPSECIntermediateOffline, которое соответствует отображаемому имени шаблона **IPSec (автономный запрос)**. 
    - **Формат имени субъекта.** Выберите в списке способ, с помощью которого Intune автоматически создает имя субъекта в запросе на сертификат. Если сертификат предназначен для пользователя, в имя субъекта можно также включить адрес электронной почты пользователя. Выберите один из следующих типов.
        - **Не настроено**.
        - **Обычное имя**.
        - **Обычное имя с адресом электронной почты**.
        - **Обычное имя как адрес электронной почты**.
    - **Альтернативное имя субъекта.** Укажите способ, с помощью которого Intune автоматически создает значения для альтернативного имени субъекта в запросе на сертификат. Например, если вы выбрали тип сертификата пользователя, в альтернативное имя субъекта можно включить имя участника-пользователя. Если сертификат клиента будет использоваться для проверки подлинности сервера политики сети, в качестве альтернативного имени субъекта необходимо задать имя участника-пользователя.
    - **Расширенное использование ключа** (Android). Выберите **Добавить**, чтобы добавить значения для назначения сертификата. В большинстве случаев для сертификата потребуется **Проверка подлинности клиента** , чтобы пользователь или устройство могли выполнить проверку подлинности на сервере. Однако при необходимости можно добавить любые другие варианты использования ключа. 
    - **Корневой сертификат** (Android). Выберите профиль корневого сертификата ЦС, настроенный ранее и назначенный пользователю или устройству. Этот сертификат ЦС должен быть корневым сертификатом ЦС, который выдаст сертификат, настраиваемый в данном профиле сертификата.
8. По завершении вернитесь в колонку **Создание профиля** и щелкните **Создать**.

Созданный профиль отобразится в колонке со списком профилей.

## <a name="task-4-assign-certificate-profiles"></a>Задача 4. Назначение профилей сертификатов

Прежде чем назначать группам профили сертификатов, необходимо учесть следующее:

- При назначении профилей сертификатов группам на устройстве устанавливается файл сертификата из профиля сертификата доверенного ЦС. Устройство использует профиль сертификата SCEP или PKCS, чтобы создать запрос на сертификат.
- Профили сертификата устанавливаются на устройствах только той платформы, которую вы использовали при создании профиля.
- Вы можете развернуть профили сертификатов в коллекциях пользователей или устройств.
- Чтобы опубликовать сертификат на устройстве сразу после регистрации, разверните профиль сертификата в группе пользователей, а не в группе устройств. При развертывании в группе устройств для получения политик требуется полная регистрация устройства.
- Хотя каждый профиль развертывается отдельно, вам также следует развернуть доверенный корневой ЦС, а также профиль SCEP или PKCS. В противном случае произойдет сбой политики сертификата SCEP или PKCS.

## <a name="next-steps"></a>Дальнейшие действия
Общие сведения о назначении профилей устройств см. в [этой статье](how-to-assign-device-profiles.md).

