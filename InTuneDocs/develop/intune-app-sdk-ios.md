---
title: "Руководство для разработчиков по пакету SDK для приложений Microsoft Intune в iOS | Документация Майкрософт"
description: "Пакет SDK для приложений Microsoft Intune в iOS позволяет встроить в вашем приложении для iOS политики защиты приложений Intune в виде системы управления мобильными приложениями (MAM)."
keywords: 
author: mtillman
manager: angrobe
ms.author: mtillman
ms.date: 12/15/2016
ms.topic: article
ms.prod: 
ms.service: microsoft-intune
ms.technology: 
ms.assetid: 8e280d23-2a25-4a84-9bcb-210b30c63c0b
ms.reviewer: oydang
ms.suite: ems
ms.custom: intune-classic
translationtype: Human Translation
ms.sourcegitcommit: 96861614075d4eed41ca440af8a8cc42e5f2ff38
ms.openlocfilehash: 8633de5aea6cc3f98c5e331fc3de43daf85903ae
ms.lasthandoff: 02/23/2017


---

# <a name="microsoft-intune-app-sdk-for-ios-developer-guide"></a>Руководство для разработчиков по пакету SDK для приложений Microsoft Intune в iOS

> [!NOTE]
> Сначала может иметь смысл прочесть статью [Начало работы с пакетом SDK для приложений Intune](intune-app-sdk-get-started.md), в которой описана подготовка к интеграции на каждой поддерживаемой платформе.

Пакет SDK приложений Microsoft Intune для iOS позволяет встроить в ваше приложение для iOS политики защиты приложений, также известные как политики управления мобильными приложениями (MAM). В приложение, которое использует MAM, встроен пакет SDK для приложений Intune. Это позволяет ИТ-администраторам развертывать политики защиты приложений в вашем мобильном приложении, когда Intune активно управляет им.

## <a name="prerequisites"></a>Необходимые компоненты

* Потребуется компьютер под управлением Mac OS X 10.8.5 или более поздней версии с установленным набором инструментов XCode версии 5 или более поздней.

* См. статью [Условия лицензии пакета SDK для приложений Intune для iOS](https://github.com/msintuneappsdk/ms-intune-app-sdk-ios/blob/master/Microsoft%20License%20Terms%20Intune%20App%20SDK%20for%20iOS%20.pdf). Распечатать и сохранить копию условий лицензии для своих записей. Скачивая и используя пакет SDK для приложений Intune в iOS, вы соглашаетесь с этими условиями лицензии.  Если вы не согласны, не используйте это программное обеспечение.

* Скачайте файлы для пакета SDK для приложений Intune в iOS на сайте [GitHub](https://github.com/msintuneappsdk/ms-intune-app-sdk-ios).

## <a name="whats-in-the-sdk"></a>Состав пакета SDK

Пакет SDK для приложений Intune в iOS включает в себя статическую библиотеку, файлы ресурсов, заголовки API, PLIST-файл настроек отладки и конфигуратор. Для большинства применяемых политик достаточно, чтобы в мобильные приложения были просто включены файлы ресурсов и статические связи с библиотеками. Расширенные функции Intune MAM применяются через API-интерфейсы.

В этом руководстве рассматривается использование следующих компонентов пакета SDK для приложений Intune в iOS:

* **libIntuneMAM.a**: статическая библиотека пакета SDK для приложений Intune. Если приложение не использует расширения, свяжите эту библиотеку с проектом, чтобы включить приложение в систему управления мобильными приложениями Intune.

* **IntuneMAM.framework**: платформа пакета SDK для приложений Intune. Свяжите эту платформу с проектом, чтобы включить приложение в систему управления мобильными приложениями Intune. Если приложение использует расширения, применяйте платформу вместо статической библиотеки, чтобы проект не создавал несколько копий статической библиотеки.

* **IntuneMAMResources.bundle**: пакет ресурсов, на которых основан пакет SDK.

* **Заголовки**: предоставляет API пакета SDK для приложений Intune. При использовании API необходимо включить файл заголовков, содержащий этот API. Следующие файлы заголовков включают в себя вызовы функций API, необходимые для использования функциональных возможностей пакета SDK для приложений Intune:

    * IntuneMAMAsyncResult.h
    * IntuneMAMDataProtectionInfo.h
    * IntuneMAMDataProtectionManager.h
    * IntuneMAMFileProtectionInfo.h
    * IntuneMAMFileProtectionManager.h
    * IntuneMAMPolicyDelegate.h
    * IntuneMAMLogger.h


## <a name="how-the-intune-app-sdk-works"></a>Принцип работы пакета SDK для приложений Intune

Назначение пакета SDK для приложений Intune для iOS заключается в том, чтобы добавить возможности управления в приложения iOS с минимальными изменениями кода. Сокращение объема изменений в коде уменьшает время выхода на рынок, не затрагивая согласованность и стабильность работы мобильного приложения.


## <a name="build-the-sdk-into-your-mobile-app"></a>Интеграция пакета SDK с мобильным приложением

Чтобы использовать пакет SDK для приложений Intune, сделайте следующее:

1. **Вариант 1**: выполните связывание с библиотекой `libIntuneMAM.a`. Перетащите библиотеку `libIntuneMAM.a` в список **Linked Frameworks and Libraries** (Связанные платформы и библиотеки) цели проекта.
    ![Пакет SDK для приложений Intune в iOS — связанные платформы и библиотеки](../media/intune-app-sdk-ios-linked-frameworks-and-libraries.png)

    > [!NOTE]
    > Если вы планируете опубликовать приложение в App Store, используйте окончательную версию `libIntuneMAM.a`, которая предназначена для рабочих сред, а не отладочную версию. Окончательная версия будет находиться в папке **release**. Отладочная версия имеет подробные выходные данные, которые хорошо подходят для устранения проблем, связанных с пакетом SDK для приложений Intune.

    **Вариант 2**: выполните связывание `IntuneMAM.framework` с проектом. Перетащите библиотеку `IntuneMAM.framework` в список **Linked Frameworks and Libraries** (Связанные платформы и библиотеки) цели проекта.

    > [!NOTE]
    > При использовании платформы вам необходимо вручную убрать архитектуры симулятора из универсальной платформы перед отправкой приложения в App Store. См. раздел "Отправка приложения в App Store".

2. Добавьте в проект следующие платформы iOS:
    * MessageUI.framework
    * Security.framework
    * MobileCoreServices.framework
    * SystemConfiguration.framework
    * libsqlite3.dylib
    * libc++.dylib
    * ImageIO.framework
    * LocalAuthentication.framework
    * AudioToolbox.framework

    > [!NOTE]
    > Если приложение предназначено для iOS 7, задайте для атрибута `Status` в `LocalAuthentication.framework` значение Optional (Дополнительно). Если атрибут `Status` не задан, приложение не запустится в iOS 7.
    >
    > Кроме того, для Xcode 7 расширения `.dylib` изменились на `.tbd`.

3. Добавьте пакет ресурсов `IntuneMAMResources.bundle` в проект, перетащив этот набор в узел **Copy Bundle Resources** (Копирование ресурсов пакета) раздела **Build Phases** (Этапы сборки).
![Пакет SDK для приложений Intune для iOS — копирование ресурсов пакета](../media/intune-app-sdk-ios-copy-bundle-resources.png)

4. Добавьте `-force_load {PATH_TO_LIB}/libIntuneMAM.a` в любое из следующих расположений, заменив `{PATH_TO_LIB}` путем к пакету SDK для приложений Intune:
    * Параметр конфигурации сборки `OTHER_LDFLAGS` проекта.
    * **Other Linker Flags** (Другие флаги компоновщика) в пользовательском интерфейсе.<br>

    > [!NOTE]
    > Чтобы найти `PATH_TO_LIB`, выберите файл `libIntuneMAM.a`, а затем пункт **Получить сведения** в меню **Файл**. Скопируйте и вставьте данные **Where** (Где) (путь) из раздела **General** (Общие) окна **Info** (Сведения).

5. Если ваше мобильное приложение определяет главный NIB- или STORYBOARD-файл в своем файле Info.plist, удалите поле **Main Storyboard** или **Main Nib**. Добавьте удаленные значения STORYBOARD или NIB в новый словарь IntuneMAMSettings со следующими названиями ключей, если применимо:
    * MainStoryboardFile
    * MainStoryboardFile~ipad
    * MainNibFile
    * MainNibFile~ipad

    > [!NOTE]
    > Если ваше мобильное приложение не определяет главный NIB- или STORYBOARD-файл в своем Info.plist, эти параметры не являются обязательными.

    Можно просмотреть Info.plist в необработанном формате (чтобы увидеть названия ключей), щелкнув правой кнопкой мыши в любом месте основного текста документа и изменив тип представления на **Show Raw Keys/Values** (Показать необработанные ключи/значения).

6. Включите совместное использование цепочки ключей (если оно еще не включено), щелкнув **Capabilities** (Возможности) в каждой цели проекта и включив параметр **Keychain Sharing** (Совместное использование цепочки ключей). Совместное использование цепочки ключей требуется для перехода к следующему шагу.

    > [!NOTE]
    > Профиль подготовки должен поддерживать новые значения совместного использования цепочки ключей. Группы доступа к цепочке ключей должны поддерживать подстановочный знак. Это можно проверить, открыв MOBILEPROVISION-файл в текстовом редакторе, найдя **keychain-access-groups** и убедившись в наличии подстановочного знака. Пример.
    ```xml
    <key>keychain-access-groups</key>
    <array>
    <string>YOURBUNDLESEEDID.*</string>
    </array>
    ```

7. После включения совместного использования цепочки ключей сделайте следующее для создания отдельной группы доступа, в которой будут храниться данные пакета SDK для приложений Intune. Группу доступа к цепочке ключей можно создать при помощи пользовательского интерфейса или файла прав.

    Если группа доступа к цепочке ключей создается при помощи пользовательского интерфейса:

    а. Если для мобильного приложения не определено ни одной группы доступа к цепочке ключей, добавьте идентификатор пакета приложения в качестве первой группы.

    b. Добавьте группу общей цепочки ключей `com.microsoft.intune.mam`. Пакет SDK для приложений Intune использует эту группу доступа для хранения данных.

    в. Добавьте `com.microsoft.adalcache` в свои существующие группы доступа.

    ![Пакет SDK для приложений Intune в iOS — совместное использование цепочки ключей](../media/intune-app-sdk-ios-keychain-sharing.png)

    Если для создания группы доступа к цепочке ключей вы используете файл прав, добавьте `$(AppIdentifierPrefix)` в начало этой группы в файле прав. Пример.  

    * `$(AppIdentifierPrefix)com.microsoft.intune.mam`
    * `$(AppIdentifierPrefix)com.microsoft.adalcache`

    > [!NOTE]
    > Файл прав — это XML-файл, который является уникальным в рамках вашего мобильного приложения. Он используется для задания специальных разрешений и возможностей в вашем приложении для iOS.

8. Если приложение определяет схемы URL-адресов в своем файле Info.plist, добавьте другую схему с суффиксом `-intunemam` для каждой схемы URL-адресов.

9. В случае мобильных приложений для iOS 9 и более поздней версии необходимо включить в массив `LSApplicationQueriesSchemes` в файле Info.plist приложения каждый из протоколов, которые приложение передает в `UIApplication canOpenURL`. Кроме того, для каждого из указанных протоколов следует добавить новый протокол, добавив к нему суффикс `-intunemam`. Следует также включить `http-intunemam`, `https-intunemam`и `ms-outlook-intunemam` в этот массив.

10. Если в файле прав приложения определены группы приложений, добавьте эти группы в словарь IntuneMAMSettings ключа `AppGroupIdentifiers` в виде массива строк.

11. Свяжите мобильное приложений с библиотекой проверки подлинности Azure Directory (ADAL) Библиотека ADAL для Objective C доступна [на сайте GitHub](https://github.com/AzureAD/azure-activedirectory-library-for-objc).

    > [!NOTE]
    > Пакет SDK для приложений Intune был проверен на соответствие коду ветви брокера ADAL от 19 июня 2015 г. Убедитесь, что связывание производится с последней или рабочей версией библиотеки ADAL.

12. Включите пакет ресурсов `ADALiOSBundle.bundle` в проект, перетащив его в узел **Copy Bundle Resources** (Копирование ресурсов пакета) раздела **Build Phases** (Этапы сборки).

13. Используйте параметр компоновщика `-force_load PATH_TO_ADAL_LIBRARY` при связывании с библиотекой.

    Добавьте `-force_load {PATH_TO_LIB}/libADALiOS.a` в параметр конфигурации сборки `OTHER_LDFLAGS` проекта или в **Other Linker Flags** (Другие флаги компоновщика) в пользовательском интерфейсе. `PATH_TO_LIB` следует заменить на расположение двоичных файлов ADAL.



## <a name="set-up-azure-directory-authentication-library"></a>Настройка библиотеки проверки подлинности Azure Active Directory

Пакет SDK для приложений Intune использует ADAL в рамках своих процедур проверки подлинности и условного запуска. Он также использует ADAL для регистрации удостоверения пользователя в службе MAM для управления без сценариев регистрации устройства.

Как правило, ADAL требует, чтобы приложение было зарегистрировано в Azure Active Directory (Azure AD) и получило уникальный идентификатор — идентификатор клиента, а также другие идентификаторы, чтобы гарантировать защищенность токенов, предоставленных этому приложению. Пакет SDK для приложений Intune использует значения регистрации по умолчанию при подключении к Azure AD.  

Если само приложение использует ADAL для проверки подлинности, оно должно применить существующие значения регистрации и переопределить значения пакета SDK для приложений Intune по умолчанию. Это гарантирует, что пользователей не попросят пройти проверку подлинности дважды (один раз в пакете SDK для приложений Intune, а другой — в приложении).

### <a name="adal-faqs"></a>Часто задаваемые вопросы по ADAL

**Какие двоичные файлы ADAL использовать?**

Сейчас пакет SDK для приложений Intune использует ветвь брокера [ADAL на GitHub](https://github.com/AzureAD/azure-activedirectory-library-for-objc) для обеспечения работы приложений, требующих условный доступ (эти приложения, таким образом, зависят от приложения Microsoft Authenticator). Тем не менее пакет SDK по-прежнему совместим с главной ветвью ADAL. Используйте ту ветвь, которая лучше подходит для вашего приложения.

**Как выполнять связывание с двоичными файлами ADAL?**

Добавьте `-force_load {PATH_TO_LIB}/libADALiOS.a` в параметр конфигурации сборки `OTHER_LDFLAGS` проекта или в **Other Linker Flags** (Другие флаги компоновщика) в пользовательском интерфейсе. `PATH_TO_LIB` следует заменить на расположение двоичных файлов ADAL. Кроме того, обязательно скопируйте набор ADAL в приложение.  

Подробности см. в инструкциях из раздела [ADAL на GitHub](https://github.com/AzureAD/azure-activedirectory-library-for-objc).

**Как использовать кэш ADAL совместно с другими приложениями, подписанными при помощи того же профиля подготовки?**

Если для приложения не определено ни одной группы доступа к цепочке ключей, добавьте идентификатор пакета приложения в качестве первой группы.

Включите единый вход ADAL, добавив группы доступа `com.microsoft.adalcache` и `com.microsoft.workplacejoin` к правам цепочки ключей.

Если вы явным образом задаете группу цепочки ключей для общего кэша ADAL, убедитесь, что она имеет значение `<app_id_prefix>.com.microsoft.adalcache`. ADAL автоматически задает это значение, пока вы не переопределите его. Если вы хотите задать настраиваемую группу цепочки ключей для замены `com.microsoft.adalcache`, укажите ее в разделе "IntuneMAMSettings" файла Info.plist, используя ключ `ADALCacheKeychainGroupOverride`.

**Как заставить пакет SDK для приложений Intune применить параметры ADAL, которые уже использует мое приложение?**

Если приложение уже использует ADAL, обратитесь к разделу [Настройка параметров для пакета SDK приложений Intune ](#configure-settings-for-the-intune-app-sdk), чтобы указать значения следующих параметров:  

* ADALClientId
* ADALAuthority
* ADALRedirectUri
* ADALRedirectScheme
* ADALCacheKeychainGroupOverride


**Как переопределить URL-адрес Центра Azure AD на URL-адрес конкретного клиента, предоставляемый во время выполнения?**

Задайте свойство `aadAuthorityUriOverride` в экземпляре IntuneMAMPolicyManager.

> [!NOTE]
> Это потребуется в случае использования MAM без регистрации устройств, чтобы позволить пакету SDK многократно задействовать токен обновления ADAL, полученный приложением.

Пакет SDK будет продолжать использовать этот URL-адрес Центра для обновления политики и любых последующих запросов на регистрацию, пока это значение не будет очищено или изменено.  Поэтому очень важно очищать значение, когда пользователь организации выходит из приложения, и сбрасывать его при входе нового пользователя организации.

**Что делать, если мое приложение использует ADAL для проверки подлинности?**

Если приложение уже использует ADAL для проверки подлинности, необходимо сделать следующее:

1. В словаре IntuneMAMSettings с названием ключа `ADALClientId` в файле Info.plist проекта укажите идентификатор клиента, используемый вызовами ADAL.

2. В словаре IntuneMAMSettings с названием ключа `ADALAuthority` также укажите центр сертификации Azure AD.

3. В словаре IntuneMAMSettings с названием ключа `ADALRedirectUri` также укажите URI перенаправления, который будет использоваться для вызовов ADAL. В зависимости от формата URI перенаправления приложения может также потребоваться указать `ADALRedirectScheme`.

**Что делать, если мое приложение еще не использует ADAL для проверки подлинности?**

Если приложение не использует ADAL, пакет SDK для приложений Intune предоставит значения по умолчанию для параметров ADAL и будет обрабатывать операции проверки подлинности в Azure AD.

## <a name="register-your-app-with-the-intune-mam-service"></a>Регистрация приложения в службе Intune MAM

### <a name="use-the-apis"></a>Использование API
Пакет SDK для приложений Intune теперь позволяет приложениям для iOS получать политики защиты приложений из Intune без регистрации в службе управления мобильными устройствами Intune (MDM). Для поддержки этой функции пакет SDK предоставляет новые интерфейсы API, которые позволяют приложению получать политики защиты приложений. Чтобы использовать новые API-интерфейсы, сделайте следующее:

1. Используйте последний выпуск пакета SDK для приложений Intune, поддерживающий управление приложениями как с регистрацией устройств, так и без нее. .

2. Добавьте IntuneMAMEnrollment.h во все файлы, которые будут вызывать API-интерфейсы.

### <a name="register-accounts"></a>Регистрация учетных записей

Приложение может получать политики защиты приложений из службы Intune, если оно зарегистрировано от имени учетной записи указанного пользователя. Приложение отвечает за регистрацию любого вошедшего в систему пользователя с использованием пакета SDK для приложений Intune. После проверки подлинности учетной записи нового пользователя приложение должно вызвать метод `registerAndEnrollAccount` из Headers/IntuneMAMEnrollment.h:

```objc
/**


 *  This method will add the account to the list of registered accounts.
 *  An enrollment request will immediately be started.
 *  @param identity The UPN of the account to be registered with the SDK
 */

(void)registerAndEnrollAccount:(NSString *)identity;

```
Путем вызова метода `registerAndEnrollAccount` пакет SDK регистрирует учетную запись пользователя и пытается зарегистрировать приложение от имени этой учетной записи. Если по какой-либо причине регистрация не удается, пакет SDK повторит ее попытку через 24 часа. В целях отладки приложение может через делегата получать уведомления о результатах запросов на регистрацию.

После вызова этого API приложение может продолжить работу в обычном режиме. В случае успешной регистрации пакет SDK уведомит пользователя о том, что требуется перезапуск приложения. При этом пользователь может немедленно перезапустить приложение.

### <a name="deregister-accounts"></a>Отмена регистрации учетных записей

Перед выходом пользователя из приложения оно должно отменить регистрацию пользователя в пакете SDK. Этим обеспечивается следующее:

1. Прекращаются повторные попытки регистрации для учетной записи пользователя.

2. Если пользователь успешно зарегистрировал приложение, регистрация пользователя и приложения в службе MAM Intune будет отменена, а политики защиты приложений будут удалены.

3. Если приложение инициирует выборочную очистку данных (что необязательно), все рабочие и учебные данные будут удалены.

До выхода пользователя из системы приложение должно вызвать следующий API из Headers/IntuneMAMEnrollment.h:

```objc
/*
 *  This method will remove the provided account from the list of
 *  registered accounts.  Once removed, if the account has enrolled
 *  the application, the account will be un-enrolled.
 *  @note In the case where an un-enroll is required, this method will block
 *  until the Intune MAM AAD token is acquired, then return.  This method must be called before  
 *  the user is removed from the application (so that required AAD tokens are not purged
 *  before this method is called).
 *  @param identity The UPN of the account to be removed.
 *  @param doWipe   If YES, a selective wipe if the account is un-enrolled
 */

(void)deRegisterAndUnenrollAccount:(NSString *)identity withWipe:(BOOL)doWipe;
```

Этот метод должен вызываться до удаления токенов Azure AD учетной записи пользователя. Пакету SDK требуется, чтобы токен приложения пользователя выполнял определенные запросы к службе MAM Intune от имени пользователя.

Если приложение самостоятельно удалит рабочие или учебные данные пользователя, можно задать для флага `doWipe` значение False. В противном случае пакет SDK в приложении может инициировать выборочную очистку данных. Это приведет к вызову делегата выборочной очистки данных приложения.

```objc
[[IntuneMAMEnrollmentManager instance] deRegisterAndUnenrollAccount:@”user@foo.com” withWipe:YES];
```

### <a name="enroll-without-prior-sign-in"></a>Регистрация без предварительного входа в систему

Если пользователь не вошел в Azure Active Directory, то приложение все равно может получать политики защиты приложений из службы Intune с помощью вызова интерфейса API. При этом выполнять проверку подлинности будет пакет SDK. Этот способ нужно использовать, если проверка подлинности пользователя в Azure AD не была выполнена, но приложению все равно необходимо получить политики защиты приложений для защиты данных. Например, если для входа в приложение используется другая служба проверки подлинности или если приложение не поддерживает вход. Для этого приложение должно вызвать метод `loginAndEnrollAccount` из Headers/IntuneMAMEnrollment.h:

```objc
/**
 *  Creates an enrollment request which is started immediately.
 *  If no token can be retrieved for the identity, the user will be prompted
 *  to enter their credentials, after which enrollment will be retried.
 *  @param identity The UPN of the account to be logged in and enrolled.
 */
 (void)loginAndEnrollAccount: (NSString *)identity;

```

Вызвав этот метод, пакет SDK запросит учетные данные пользователя, если не удастся найти токен. После пакет SDK попытается зарегистрировать приложение от имени этой учетной записи. Этот метод можно вызывать с "nil" в качестве удостоверения. В этом случае пакет SDK регистрируется на устройстве при помощи существующего пользователя MAM, а при отсутствии такового запрашивает имя пользователя.

В случае сбоя регистрации приложение должно иметь возможность снова вызвать этот API позже (в зависимости от характера сбоя). Приложение может через делегата получать уведомления о результатах запросов на регистрацию.

После вызова этого API приложение может продолжить работу в обычном режиме. В случае успешной регистрации пакет SDK уведомит пользователя о том, что требуется перезапуск приложения.

## <a name="status-result-and-debug-notifications"></a>Уведомления о состоянии, результатах и отладке

Приложение может получать уведомления о состоянии, результатах и отладке для следующих запросов в службе MAM Intune:

 - запросы на регистрацию;
 - запросы на обновление политики;
 - запросы на отмену регистрации.

Уведомления передаются посредством методов делегата в Headers/IntuneMAMEnrollmentDelegate.h:

```objc
/**
 *  Called when an enrollment request operation is completed.
 * @param status status object containing debug information
 */

(void)enrollmentRequestWithStatus:(IntuneMAMEnrollmentStatus *)status;

/**
 *  Called when a MAM policy request operation is completed.
 *  @param status status object containing debug information
 */
(void)policyRequestWithStatus:(IntuneMAMEnrollmentStatus *)status;

/**
 *  Called when a un-enroll request operation is completed.
 *  @Note: when a user is un-enrolled, the user is also de-registered with the SDK
 *  @param status status object containing debug information
 */

(void)unenrollRequestWithStatus:(IntuneMAMEnrollmentStatus *)status;

```

Эти методы делегата возвращают объект `IntuneMAMEnrollmentStatus`, который содержит следующую информацию:

- Удостоверение учетной записи, связанной с запросом
- Код состояния, обозначающий результат запроса.
- Строка ошибки с описанием кода состояния
- Объект `NSError`

Этот объект и коды состояний определяются в файле IntuneMAMEnrollmentStatus.h.




### <a name="sample-code"></a>Образец кода

Ниже приведены примеры реализации методов делегата:

```objc
- (void)enrollmentRequestWithStatus:(IntuneMAMEnrollmentStatus *)status
{
    NSLog(@"enrollment result for identity %@ with status code %ld", status.identity, (unsigned long)status.statusCode);
    NSLog(@"Debug Message: %@", status.errorString);
}


- (void)policyRequestWithStatus:(IntuneMAMEnrollmentStatus *)status
{
    NSLog(@"policy check-in result for identity %@ with status code %ld", status.identity, (unsigned long)status.statusCode);
    NSLog(@"Debug Message: %@", status.errorString);
}

- (void)unenrollRequestWithStatus:(IntuneMAMEnrollmentStatus *)status
{
    NSLog(@"un-enroll result for identity %@ with status code %ld", status.identity, (unsigned long)status.statusCode);
    NSLog(@"Debug Message: %@", status.errorString);
}

```

## <a name="app-restart"></a>Перезапуск приложения

Когда приложение впервые получает политики защиты приложений, нужно перезапустить его, чтобы необходимые обработчики вступили в силу. Чтобы уведомить приложение о необходимости перезапуска, пакет SDK предоставляет метод делегата в Headers/IntuneMAMPolicyDelegate.h.

```objc
 - (BOOL) restartApplication
```
Возвращаемое значение этого метода сообщает SDK, сможет ли приложение выполнить требуемый перезапуск.   

 - Если возвращается значение True, за обработку перезапуска будет отвечать приложение.   

 - Если возвращается значение false, пакет SDK перезапускает приложение. Пакет SDK сразу покажет диалоговое окно с сообщением о том, что пользователю необходимо перезапустить приложение.

## <a name="customize-your-apps-behavior"></a>Настройка поведения вашего приложения

Пакет SDK для приложений Intune имеет несколько интерфейсов API, которые можно вызвать, чтобы получить сведения о политике защиты приложений Intune, которые были развернуты для приложения. Эти сведения можно использовать для настройки поведения приложения. Большинство параметров политики защиты приложения применяются автоматически пакетом SDK, а не приложением. Единственный параметр, который нужно реализовать в приложении, — элемент управления "Сохранить как".

### <a name="get-the-app-protection-policy-settings"></a>Получение параметров для политики защиты приложений

#### <a name="intunemampolicymanagerh"></a>IntuneMAMPolicyManager.h
Класс IntuneMAMPolicyManager предоставляет политику защиты приложения Intune, которая была развернута для приложения. В частности, он предоставляет интерфейсы API, которые удобны для [Включения множественного удостоверения](#-enable-multi-identity-optional).

#### <a name="intunemampolicyh"></a>IntuneMAMPolicy.h
Класс IntuneMAMPolicy предоставляет политику защиты приложения Intune, которая была развернута для приложения. Большинство параметров политики в этом классе применяются пакетом SDK, но вы всегда можете изменить поведение своего приложения на основе того, как применяются параметры политики.

Этот класс предоставляет некоторые интерфейсы API, которые необходимы для реализации элемента управления "Сохранить как". Они описаны в следующем разделе.

### <a name="implement-save-as-controls"></a>Реализация элементов управления "Сохранить как"

Служба Intune позволяет ИТ-администраторам выбирать места хранения, в которых управляемое приложение может сохранять данные. Чтобы проверить, разрешено ли сохранение данных в том или ином расположении для хранения, приложение может воспользоваться интерфейсом API **isSaveToAllowedForLocation**, который получает эти сведения от пакета SDK для приложений Intune. Этот интерфейс определен в файле **IntuneMAMPolicy.h**.

Перед тем как приложения смогут сохранить управляемые данные в облачном или локальном расположении, они должны вызвать API **isSaveToAllowedForLocation**, чтобы определить, разрешил ли ИТ-администратор сохранение данных в этом месте.

При использовании API **isSaveToAllowedForLocation** приложение должно передать имя субъекта-пользователя в расположение для хранения данных, если оно доступно.

#### <a name="supported-save-locations"></a>Поддерживаемые расположения сохранения

Интерфейс API **isSaveToAllowedForLocation** предоставляет константы, которые определяют, разрешил ли ИТ-администратор сохранять данные в следующих расположениях, которые определены в файле IntuneMAMPolicy.h:

* IntuneMAMSaveLocationOther
* IntuneMAMSaveLocationOneDriveForBusiness
* IntuneMAMSaveLocationSharePoint
* IntuneMAMSaveLocationBox
* IntuneMAMSaveLocationDropbox
* IntuneMAMSaveLocationGoogleDrive
* IntuneMAMSaveLocationLocalDrive

Приложения должны использовать константы API **isSaveToAllowedForLocation** для проверки того, можно ли сохранять данные в расположениях, считающихся управляемыми (например, в OneDrive для бизнеса) или личными. Кроме того, этот API следует использовать, если приложению не удается проверить, является ли расположение управляемым или личным.

"Личные" расположения представлены константой `IntuneMAMSaveLocationOther`.

Константу `IntuneMAMSaveLocationLocalDrive` следует использовать, если приложение сохраняет данные в каком-либо месте на локальном устройстве.

## <a name="configure-settings-for-the-intune-app-sdk"></a>Настройка параметров пакета SDK для приложений Intune

Словарь **IntuneMAMSettings** в файле Info.plist приложения используется для настройки пакета SDK для приложений Intune. В таблице ниже приведен список всех поддерживаемых параметров.

Некоторые из этих параметров уже описаны в предыдущих разделах, а некоторые используются только в определенных приложениях.

Параметр  | Тип  | Определение | Необходим?
--       |  --   |   --       |  --
ADALClientId  | Строка  | Идентификатор клиента Azure AD приложения. | Требуется, если приложение использует ADAL. |
ADALAuthority | Строка | Используется центр сертификации Azure AD приложения. Вам нужно использовать собственное окружение, где были настроены учетные записи AAD. | Требуется, если приложение использует ADAL. Если это значение отсутствует, используется значение по умолчанию для Intune.|
ADALRedirectUri  | Строка  | URI перенаправления Azure AD для приложения. | Если приложение использует ADAL, требуется ADALRedirectUri или ADALRedirectScheme.  |
ADALRedirectScheme  | Строка  | Схема перенаправления Azure AD для приложения. Может использоваться вместо ADALRedirectUri, если URI перенаправления приложения имеет формат `scheme://bundle_id`. | Если приложение использует ADAL, требуется ADALRedirectUri или ADALRedirectScheme. |
ADALLogOverrideDisabled | Логическое значение  | Указывает, будет ли пакет SDK перенаправлять все журналы ADAL (включая вызовы ADAL из приложения при их наличии) в свой файл журнала. По умолчанию используется значение NO (Нет). Задайте значение YES (Да), если в приложении настроен собственный обратный вызов журнала ADAL. | Необязательный параметр. |
ADALCacheKeychainGroupOverride | Строка  | Указывает группе цепочки ключей использовать кэш ADAL вместо "com.microsoft.adalcache". Обратите внимание, что этот параметр не содержит префикс идентификатора приложения. Он будет добавлен к предоставленной строке во время выполнения. | Необязательный параметр. |
AppGroupIdentifiers | Массив строк  | Массив групп приложений из раздела com.apple.security.application-groups прав приложения. | Требуется, если приложение использует группы приложений. |
ContainingAppBundleId | Строка | Указывает идентификатор пакета приложения, которое содержит расширение. | Требуется для расширений iOS. |
DebugSettingsEnabled| Логическое значение | Если задано значение "YES" (Да), можно применить политики теста в пакете параметров. В поставляемых приложения этот параметр *должен* быть отключен. | Необязательный параметр. |
MainNibFile<br>MainNibFile~ipad  | Строка  | Этот параметр должен содержать имя главного NIB-файла приложения.  | Требуется, если приложение определяет MainNibFile в файле Info.plist. |
MainStoryboardFile<br>MainStoryboardFile~ipad  | Строка  | Этот параметр должен содержать имя главного STORYBOARD-файла приложения. | Требуется, если приложение определяет UIMainStoryboardFile в Info.plist. |
MAMPolicyRequired| Логическое значение| Указывает, будет ли блокироваться запуск приложения при отсутствии политики защиты приложений Intune. По умолчанию используется значение NO (Нет). <br><br> Примечание. В магазин приложений невозможно отправить приложения, у которых параметр MAMPolicyRequired имеет значение "YES". | Необязательный параметр. |
MAMPolicyWarnAbsent | Логическое значение| Указывает, будет ли приложение, для которого не настроена политика защиты приложений Intune, уведомлять пользователя во время запуска. Примечание. В магазин невозможно отправлять приложения, у которых для этого параметра задано значение YES (Да). | Необязательный параметр. |
MultiIdentity | Логическое значение| Указывает, поддерживает ли приложение множество удостоверений. | Необязательный параметр. |
SplashIconFile <br>SplashIconFile~ipad | Строка  | Задает файл значка заставки Intune. | Необязательный параметр. |
SplashDuration | Число | Минимальное число секунд, в течение которого заставка Intune отображается при запуске приложения. По умолчанию используется значение 1,5. | Необязательный параметр. |
BackgroundColor| Строка| Задает цвет фона для заставки и экрана ПИН-кода. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.   | Необязательный параметр. По умолчанию используется светло-серый цвет. |
ForegroundColor| Строка| Задает цвет фона для заставки и экрана ПИН-кода, а также цвет текста. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.  | Необязательный параметр. По умолчанию используется значение black (черный). |
AccentColor | Строка| Задает цвет элементов для экрана ввода ПИН-кода, например цвет текста кнопки и цвет выделения поля. Принимает шестнадцатеричную строку RGB в виде "#XXXXXX", где "X" может принимать значение от 0 до 9 или от A до F. Символ решетки можно пропустить.| Необязательный параметр. По умолчанию используется системный синий цвет. |
MAMTelemetryDisabled| Логическое значение| Указывает, будет ли пакет SDK отправлять данные телеметрии в свою серверную часть.| Необязательный параметр. |

> [!NOTE]
> Если приложение будет размещено в магазине приложений, параметр `MAMPolicyRequired` должен быть установлен равным "NO" в соответствии со стандартами магазина приложений.

## <a name="telemetry"></a>Телеметрия

По умолчанию пакет SDK для приложений Intune в iOS записывает данные телеметрии при следующих событиях использования. Эти данные отправляются в Microsoft Intune.

* **Запуск приложения**: чтобы предоставить Microsoft Intune информацию об использовании приложений с поддержкой MAM по типу управления (MAM с MDM, MAM без регистрации MDM и т. д.).

* **Вызовы регистрации**: чтобы предоставить Microsoft Intune информацию об уровне успешности и других метриках производительности вызовов регистрации со стороны клиента.

> [!NOTE]
> Если вы решили не отправлять данные телеметрии пакета SDK для приложений Intune в Microsoft Intune из своего мобильного приложения, необходимо отключить фиксирование данных телеметрии пакета SDK для приложений Intune. Задайте для свойства `MAMTelemetryDisabled` значение YES (Да) в словаре IntuneMAMSettings.

## <a name="enable-multi-identity-optional"></a>Включение множественного удостоверения (необязательно)

По умолчанию пакет SDK применяет политику ко всему приложению. Использование нескольких удостоверений — это функция MAM, которую можно включить для применения политики на уровне удостоверения. Для этого требуется больше содействия со стороны приложения, чем для других функций MAM.

Приложение должно уведомить пакет SDK для приложения о том, что оно собирается сменить активное удостоверение. Пакет SDK также будет уведомлять приложение, когда требуется сменить удостоверение. Сейчас поддерживается только одно управляемое удостоверение. После регистрации приложения или устройства пользователем пакет SDK использует это удостоверение, считая его основным управляемым удостоверением. Другие пользователи в приложении будут рассматриваться как неуправляемые и не будут иметь ограничения для параметров политик.

Обратите внимание, что удостоверение определяется просто в виде строки. В удостоверениях не учитывается регистр. Запросы удостоверения, направляемые пакету SDK, могут возвращать удостоверения с регистром, отличным от изначального.

### <a name="identity-overview"></a>Общие сведения об удостоверениях

Удостоверение — это просто имя пользователя учетной записи (например, user@contoso.com). Разработчики могут задать удостоверение приложения на следующих уровнях:

* **Удостоверение процесса**: задает удостоверение всего процесса и используется в основном для приложений с одним удостоверением. Это удостоверение затрагивает все задачи, файлы и элементы пользовательского интерфейса.

* **Удостоверение пользовательского интерфейса**: определяет, какие политики применяются к задачам пользовательского интерфейса в основном потоке, таким как вырезание, копирование, вставка, ввод ПИН-кода, проверка подлинности и совместный доступ к данным. Удостоверение пользовательского интерфейса не затрагивает задачи, связанные с файлами, такие как шифрование и резервное копирование.

* **Удостоверение потока**: влияет на то, какие политики применяются к текущему потоку. Это удостоверение затрагивает все задачи, файлы и элементы пользовательского интерфейса.

Независимо от того, является ли пользователь управляемым, приложение отвечает за правильную настройку удостоверений.

В любой момент времени каждый поток имеет действующее удостоверение для задач, связанных с пользовательским интерфейсом, и задач файлов. Это удостоверение используется для определения применяемых политик (если таковые имеются). Если в качестве удостоверения задано значение "no identity" (без удостоверения) либо пользователь не является управляемым, никакие политики не применяются. На рисунках ниже показано, как определяются действующие удостоверения.

  ![Пакет SDK для приложений Intune в iOS — связанные платформы и библиотеки](../media/intune-app-sdk/ios-thread-identities.png)

### <a name="thread-queues"></a>Очереди потоков

Приложения часто отправляют асинхронные и синхронные задачи в очереди потоков. Пакет SDK перехватывает вызовы Grand Central Dispatch (Grand Central Dispatch) и сопоставляет удостоверение текущего потока с направленными задачами. При выполнении задач пакет SDK временно меняет удостоверение потока на удостоверение, связанное с конкретной задачей, выполняет ее, а затем восстанавливает исходное удостоверение потока.


Так как `NSOperationQueue` основана на GCD, `NSOperations` будет выполняться с удостоверением потока во время добавления задач в `NSOperationQueue`. `NSOperations` или функции, отправленные напрямую при помощи GCD, также могут менять удостоверение текущего потока во время выполнения. Это удостоверение переопределяет удостоверение, унаследованное от потока диспетчеризации.

### <a name="file-owner"></a>Владелец файла

Пакет SDK отслеживает удостоверения владельцев локальных файлов и применяет нужные политики. Владелец файла задается при создании файла или при его открытии в режиме усечения. Для владельца задается действующее удостоверение для задачи, связанной с файлом, в потоке, выполняющем такую задачу.

Кроме того, приложения могут явным образом задать удостоверение для владельца файла при помощи `IntuneMAMFilePolicyManager`. Приложения могут использовать `IntuneMAMFilePolicyManager` для извлечения имени владельца файла и для задания удостоверения пользовательского интерфейса перед отображением содержимого файла.

### <a name="shared-data"></a>Файлы общих данных

Если приложение создает файлы, содержащие данные как управляемых, так и неуправляемых пользователей, оно отвечает за шифрование данных управляемых пользователей. Вы можете зашифровать данные с помощью API-интерфейсов `protect` и `unprotect` в `IntuneMAMDataProtectionManager`.

Метод `protect` принимает удостоверение, которое может относиться как к управляемому, так и к неуправляемому пользователю. Если пользователь является управляемым, данные шифруются. Если пользователь является неуправляемым, в данные добавляется заголовок, кодирующий удостоверение, но сами данные не шифруются. Метод `protectionInfo` можно использовать для извлечения владельца данных.

### <a name="share-extensions"></a>Расширения общего доступа

Если приложение содержит расширение общего доступа, владельца общего элемента можно извлечь при помощи метода `protectionInfoForItemProvider` в `IntuneMAMDataProtectionManager`. Если общий элемент является файлом, пакет SDK обрабатывает задание владельца файла. Если общий элемент — данные, приложение отвечает за задание владельца файла, если эти данные сохранены в файле, и за вызов API `setUIPolicyIdentity` перед отображением этих данных в пользовательском интерфейсе.

### <a name="turning-on-multi-identity"></a>Включение множественных удостоверений

По умолчанию приложения считаются приложениями с одним удостоверением. Пакет SDK задает удостоверение процесса для зарегистрированного пользователя. Чтобы включить поддержку множественных удостоверений, в словарь IntuneMAMSettings в файле Info.plist приложения нужно добавить логический параметр `MultiIdentity` и значение YES (Да).

> [!NOTE]
> Когда множественное удостоверение включено, удостоверениям процесса, пользовательского интерфейса и потока присваивается значение "nil". Приложение отвечает за их правильную настройку.

### <a name="switching-identities"></a>Замена удостоверений

* **Замена удостоверений, инициированная приложением**:

    При запуске приложений с множественным удостоверением считается, что они выполняются под неизвестной и неуправляемой учетной записью. Пользовательский интерфейс условного запуска не открывается, а политики не применяются к приложению. Приложение отвечает за своевременное уведомление пакета SDK о смене удостоверения. Как правило, это происходит перед тем, как приложение собирается отобразить данные для конкретной учетной записи пользователя.

    Примером служит ситуация, когда пользователь пытается открыть документ, почтовый ящик или вкладку в записной книжке. Приложению необходимо уведомить пакет SDK до фактического открытия файла, почтового ящика или вкладки. Это осуществляется посредством API `setUIPolicyIdentity` в `IntuneMAMPolicyManager`. Этот API должен вызываться независимо от того, является ли пользователь управляемым. Если пользователь является управляемым, пакет SDK выполняет проверки условного запуска, такие как обнаружение снятия ограничения на доступ к файловой системе, ПИН-код и проверка подлинности.

    Результат замены удостоверения возвращается в приложение асинхронно через завершающий обработчик. Приложение должно отложить открытие документа, почтового ящика или вкладки до тех пор, пока не будет возвращен код результата. Если переключить удостоверения не удалось, приложение должно отменить задачу.

* **Замена удостоверений, инициированная пакетом SDK**:

    Иногда пакету SDK необходимо, чтобы приложение переключилось на определенное удостоверение. Для обработки этого запроса приложения с множественным удостоверением должны реализовать метод `identitySwitchRequired` в `IntuneMAMPolicyDelegate`.

    Если при вызове метода приложение может обработать запрос по переключению на указанное удостоверение, оно должно передать `IntuneMAMAddIdentityResultSuccess` в завершающий обработчик. Если приложению не удается обработать смену удостоверения, ему следует передать в завершающий обработчик значение `IntuneMAMAddIdentityResultFailed`.

    Приложению не нужно вызывать `setUIPolicyIdentity` в ответ на этот вызов. Если пакету SDK необходимо, чтобы приложение переключилось на учетную запись неуправляемого пользователя, в вызов `identitySwitchRequired` передается пустая строка.

* **Выборочная очистка**:

    Когда к приложению применяется выборочная очистка, пакет SDK вызывает метод `wipeDataForAccount` в `IntuneMAMPolicyDelegate`. Приложение отвечает за удаление учетной записи указанного пользователя и любых связанных с ней данных. Пакет SDK может удалить все файлы, принадлежащие такому пользователю, и сделает это, если приложение возвращает значение FALSE из вызова `wipeDataForAccount`.

    Обратите внимание, что этот метод вызывается из фонового потока. Приложение не должно возвращать значение до тех пор, пока все данные пользователя не будут удалены (за исключением файлов, если приложение вернет значение FALSE).

## <a name="debug-the-intune-app-sdk-in-xcode"></a>Отладка пакета SDK для приложений Intune в Xcode

Перед ручным тестированием приложения с поддержкой MAM при помощи Microsoft Intune вы можете воспользоваться файлом Settings.bundle при работе в Xcode. Это позволит вам задать политики тестирования без подключения к Intune. Чтобы включить эту функцию, выполните следующие действия:

1. Добавьте файл Settings.bundle, щелкнув правой кнопкой мыши папку верхнего уровня в проекте. Выберите **Add** (Добавить) > **New File** (Новый файл) в меню. Выберите шаблон **Settings Bundle** (Пакет настроек) в разделе **Resources** (Ресурсы) для его добавления.

2. Только в отладочных сборках — скопируйте MAMDebugSettings.plist в Settings.bundle.

3. В Root.plist (который находится в Settings.bundle) добавьте параметр с `Type` = `Child Pane` и `FileName` = `MAMDebugSettings`.

4. В разделе **Settings** (Настройки) > **Имя_вашего_приложения** задайте параметр **Enable Test Policies** (Включить политики тестирования).

5. Запустите приложение (в Xcode или за его пределами).

6. В разделе **Settings** (Настройки) > **Имя_вашего_приложения** > **Enable Test Policies** (Включить политики тестирования) включите политику, например **PIN** (ПИН-код).

7. Запустите приложение (в Xcode или за его пределами). Убедитесь, что ПИН-код работает правильно.

> [!NOTE]
> Для включения и настройки параметров можно использовать меню **Settings** (Настройки) > **Имя_вашего_приложения** > **Enable Test Policies** (Включить политики тестирования).

## <a name="ios-best-practices"></a>Рекомендации по iOS

Ниже приведены рекомендации для разработки приложений для iOS:

* Файловая система iOS учитывает регистр. Убедитесь, что имена файлов, таких как `libIntuneMAM.a` и `IntuneMAMResources.bundle`, написаны в правильном регистре.

* Если Xcode не удается найти `libIntuneMAM.a`, можно устранить эту проблему, добавив путь к данной библиотеке в пути поиска компоновщика.

## <a name="faq"></a>Часто задаваемые вопросы


**Обращение ко всем интерфейсам API осуществляется через собственный язык Swift или за счет взаимодействия языков Objective-C и Swift?**

API пакета SDK для приложений Intune используют только язык Objective-C и не поддерживают собственный язык Swift.  


**Нужно ли регистрировать в службе MAM всех пользователей моего приложения?**

Нет. На самом деле с использованием пакета SDK для приложений Intune требуется регистрировать только рабочие или учебные учетные записи. Именно приложения должны определять, используется ли учетная запись в контексте рабочей или учебной.   

**А что насчет пользователей, которые уже вошли в приложение? Нужно ли их регистрировать?**

Приложение отвечает за регистрацию пользователей после успешной проверки подлинности. Приложение также отвечает за регистрацию существующих учетных записей, которые присутствовали еще до того, как приложение получило функции MAM без MDM.   

Для этого приложение должно использовать метод `registeredAccounts:`. Этот метод возвращает NSDictionary, содержащий все учетные записи, зарегистрированные в службе MAM Intune. Если любые из имеющихся в приложении учетных записей отсутствуют в списке, приложение должно зарегистрировать их при помощи `registerAndEnrollAccount:`.

**Как часто пакет SDK повторяет попытки регистрации?**

Пакет SDK автоматически повторяет все ранее неудачные попытки регистрации с 24-часовым интервалом. Пакет SDK делает это для того, чтобы убедиться, что если организация пользователя включила функции MAM после его входа в приложение, пользователь будет успешно зарегистрирован и получит политики.

Пакет SDK прекратит попытки, когда обнаружит, что пользователь успешно зарегистрировал приложение. Это вызвано тем, что только один пользователь может зарегистрировать приложение в отдельный момент времени. В случае отмены регистрации пользователя повторные попытки возобновляются с тем же 24-часовым интервалом.

**Почему требуется отменять регистрацию пользователя?**

Пакет SDK будет периодически выполнять в фоновом режиме следующие действия:

 - Если приложение еще не зарегистрировано, он будет пытаться зарегистрировать все указанные учетные записи каждые 24 часа.
 - Если приложение зарегистрировано, пакет SDK будет проверять наличие обновлений для политики защиты приложений каждые восемь часов.

При отмене регистрации пользователя пакет SDK уведомляется о том, что пользователь больше не будет использовать приложение, и можно прекратить любые периодические действия для этой учетной записи. Кроме того, при необходимости вызывается отмена регистрации приложения и выборочная очистка данных.

**Следует установить флаг doWipe в значение true в методе deregister?**

Этот метод должен вызываться перед выходом пользователя из приложения.  Если в рамках выхода данные пользователя удаляются из приложения, то для `doWipe` можно задать значение False. Однако если приложение не удаляет данные пользователя, `doWipe` следует присвоить значение True, чтобы пакет SDK мог самостоятельно удалить эти данные.

**Существуют другие способы отменены регистрации для приложения?**

Да, ИТ-администратор может отправить команду выборочной очистки данных в приложение. Регистрация пользователя будет отменена, а данные — удалены. Пакет SDK автоматически обрабатывает эту ситуацию и отправляет уведомление через метод делегата для отмены регистрации.



## <a name="submit-your-app-to-the-app-store"></a>Отправка приложения в App Store

Статическая библиотека и платформенные сборки пакета SDK для приложений Intune являются универсальными двоичными файлами. Это означает, что у них есть код для всех архитектур устройств и симуляторов. Apple отклоняет приложения, отправляемые в App Store, если они содержат код симулятора. При компиляции со статической библиотекой для сборок, предназначенных только для устройств, компоновщик автоматически удаляет код симуляторов. Выполните описанные ниже действия, чтобы убедиться в удалении всего кода симулятора, прежде чем отправлять приложение в магазин приложений.

1. Убедитесь, что `IntuneMAM.framework` находится на вашем рабочем столе.

2. Выполните следующие команды:

    ```bash
    lipo ~/Desktop/IntuneMAM.framework/IntuneMAM -remove i386 -remove x86_64 -output ~/Desktop/IntuneMAM.device_only
    ```

    ```bash
    cp ~/Desktop/IntuneMAM.device_only ~/Desktop/IntuneMAM.framework/IntuneMAM
    ```
    Первая команда удаляет архитектуры симулятора из DYLIB-файла платформы. Вторая команда копирует в каталог платформы DYLIB-файл, предназначенный только для устройств.

