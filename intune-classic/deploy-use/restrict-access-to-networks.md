---
title: "Защита доступа к сетям при помощи Cisco ISE"
description: "Используйте Cisco ISE с Intune, чтобы регистрировать устройства в Intune и обеспечивать соответствие политикам до того, как они получат доступ к сетям Wi-Fi и VPN, управляемым Cisco ISE."
keywords: 
author: arob98
ms.author: angrobe
manager: angrobe
ms.date: 01/03/2017
ms.topic: article
ms.prod: 
ms.service: microsoft-intune
ms.technology: 
ms.assetid: 5631bac3-921d-438e-a320-d9061d88726c
ms.reviewer: muhosabe
ms.suite: ems
ms.custom: intune-classic
ms.openlocfilehash: 9cc69764233fdb8bd9cba03dd0f8e841392ee19a
ms.sourcegitcommit: 769db6599d5eb0e2cca537d0f60a5df9c9f05079
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2017
---
# <a name="using-cisco-ise-with-microsoft-intune"></a>Использование Cisco ISE с Microsoft Intune

[!INCLUDE[classic-portal](../includes/classic-portal.md)]

Интеграция Intune с Cisco Identity Services Engine (ISE) позволяет создавать политики сети в среде ISE с помощью регистрации устройств и состояния соответствия Intune. Эти политики позволяют гарантировать, что доступ к сети организации будут иметь только устройства, управляемые Intune и соответствующие политикам Intune.

## <a name="configuration-steps"></a>Шаги настройки

Для использования такой интеграции не нужно настраивать клиент Intune. Вам потребуется предоставить серверу Cisco ISE разрешения для доступа к вашему клиенту Intune. Дальнейшая настройка выполняется на сервере Cisco ISE. В этой статье приводятся инструкции по предоставлению серверу ISE разрешений на доступ к клиенту Intune.

### <a name="step-1-manage-the-certificates"></a>Шаг 1. Управление сертификатами
Экспортируйте сертификат из консоли Azure Active Directory (Azure AD), а затем импортируйте его в хранилище доверенных сертификатов консоли ISE.

#### <a name="internet-explorer-11"></a>Internet Explorer 11


   а. Запустите Internet Explorer от имени администратора и выполните вход в консоль Azure AD.

   b. Щелкните значок замка в адресной строке и выберите **Просмотр сертификатов**.

   в. На вкладке **Сведения** в свойствах сертификата выберите **Копировать в файл**.

   г. На странице **Добро пожаловать в мастер экспорта сертификатов** нажмите кнопку **Далее**.

   д. На странице **Формат файла экспорта** оставьте значение по умолчанию **Двоичный стандарт X.509 с DER-шифрованием (CER)** и нажмите кнопку **Далее**.  

   е. На странице **Файл для экспорта** выберите **Обзор**, чтобы выбрать расположение для сохранения файла, и укажите имя файла. Может показаться, что вы выбираете файл для экспорта, но на самом деле вы называете файл, в который будет сохранен экспортированный сертификат. Нажмите кнопку **Далее**&gt; **Готово**.

   ж. В консоли ISE импортируйте сертификат Intune (экспортированный файл) в хранилище **Доверенных сертификатов**.

#### <a name="safari"></a>Safari

 а. Войдите в консоль Azure AD.

b. Щелкните значок замка &gt; **Дополнительные сведения**.

   в. Выберите **Просмотр сертификата** &gt; **Сведения**.

   г. Выберите сертификат, а затем выберите **Экспорт**. 

   д. В консоли ISE импортируйте сертификат Intune (экспортированный файл) в хранилище **Доверенных сертификатов**.

> [!IMPORTANT]
>
> Проверьте срок действия сертификата, поскольку по истечении срока действия этого сертификата потребуется экспортировать и импортировать новый.


### <a name="obtain-a-self-signed-cert-from-ise"></a>Получите самозаверяющий сертификат в системе ISE. 

1.  В консоли ISE последовательно выберите **Администрирование** > **Сертификаты** > **Сертификаты системы** > **Создать самозаверяющий сертификат**.  
2.       Экспортируйте самозаверяющий сертификат.
3. В текстовом редакторе отредактируйте экспортированный сертификат.

 - Удалите строку **-----BEGIN CERTIFICATE-----**
 - Удалите строку **-----END CERTIFICATE-----**
 
Убедитесь, что весь текст представляет собой одну строку.


### <a name="step-2-create-an-app-for-ise-in-your-azure-ad-tenant"></a>Шаг 2. Создание приложения для ISE в клиенте Azure AD
1. В консоли Azure AD выберите **Приложения** > **Добавить приложение** > **Добавить приложение, разрабатываемое моей организацией**.
2. Укажите имя и URL-адрес приложения. URL-адрес может быть веб-сайтом вашей компании.
3. Загрузите манифест приложения (файл JSON).
4. Измените файл манифеста JSON. В качестве значения параметра **keyCredentials** укажите измененный текст сертификата из шага 1.
5. Сохраните файл, не меняя его названия.
6. Предоставьте своему приложению разрешения на доступ к API-интерфейсу Microsoft Graph и Microsoft Intune.

 а. Для Microsoft Graph выберите следующие параметры.
    - **Разрешения приложения**: чтение данных каталога.
    - **Делегированные разрешения**:
        - доступ к данным пользователя в любое время.
        - Вход пользователей

 b. Для API-интерфейса Microsoft Intune в меню **Разрешения приложения** выберите **Получить состояние устройства и соответствия из Intune**.

7. Выберите **Просмотр конечных точек** и скопируйте следующие значения для использования при настройке параметров ISE:

|Значение на портале Azure AD|Соответствующее поле на портале ISE|
|-------------------|---------------------------------|
|Конечная точка Microsoft Azure AD Graph API|URL-адрес автоматического обнаружения|
|Конечная точка маркера OAuth 2.0|URL-адрес издания маркера|
|Добавьте в ваш код ИД клиента|Идентификатор клиента|

### <a name="step-4-upload-the-self-signed-certificate-from-ise-into-the-ise-app-you-created-in-azure-ad"></a>Шаг 4. Отправка самозаверяющего сертификата из среды в ISE в приложение ISE, созданное в Azure AD
1.     Получите отпечаток и значение сертификата в кодировке base64 из CER-файла открытого сертификата X.509. В этом примере используется PowerShell.
   
      
      $cer = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2    $cer.Import("mycer.cer")    $bin = $cer.GetRawCertData()    $base64Value = [System.Convert]::ToBase64String($bin)    $bin = $cer.GetCertHash()    $base64Thumbprint = [System.Convert]::ToBase64String($bin)    $keyid = [System.Guid]::NewGuid().ToString()
 
    Сохраните значения $base64Thumbprint, $base64Value и $keyid для использования в следующем шаге.
2.       Отправьте сертификат с помощью файла манифеста. Войдите на [портал управления Azure](https://manage.windowsazure.com).
2.      В оснастке Azure AD найдите приложение, которое вы хотите настроить с помощью сертификата X.509.
3.      Скачайте файл манифеста приложения. 
5.      Замените пустое свойство KeyCredentials: [] следующим кодом JSON.  Сложный тип KeyCredentials описан в [справочнике по сущностям и сложным типам](https://msdn.microsoft.com/library/azure/ad/graph/api/entity-and-complex-type-reference#KeyCredentialType).

 
    "keyCredentials": [ { "customKeyIdentifier": "$base64Thumbprint_from_above", "keyId": "$keyid_from_above", "type": "AsymmetricX509Cert", "usage": "Verify", "value": "$base64Value_from_above" }2. 
     ], 
 
Пример.
 
    “keyCredentials“: [
    {
    “customKeyIdentifier“: “ieF43L8nkyw/PEHjWvj+PkWebXk=”,
    “keyId“: “2d6d849e-3e9e-46cd-b5ed-0f9e30d078cc”,
    “type”: “AsymmetricX509Cert”,
    “usage”: “Verify”,
    “value”: “MIICWjCCAgSgAwIBA***omitted for brevity***qoD4dmgJqZmXDfFyQ”
    }
    ],
 
6.      Сохраните изменения в файле манифеста приложения.
7.      Отправьте измененный файл манифеста приложения через портал управления Azure.
8.      (Необязательно) Снова скачайте манифест, чтобы убедиться в наличии сертификата X.509 в приложении.

>[!NOTE]
>
> KeyCredentials — это коллекция, поэтому можно отправлять несколько сертификатов X.509 для сценариев развертывания, а также удалять сертификаты в случае нарушения безопасности.


### <a name="step-4-configure-ise-settings"></a>Шаг 4. Настройка параметров ISE
В консоли администрирования ISE задайте следующие значения параметров.
  - **Тип сервера**: Mobile Device Manager.
  - **Тип проверки подлинности**: OAuth, учетные данные клиента.
  - **Автоматическое обнаружение**: да.
  - **URL-адрес автоматического обнаружения**: *введите значение из шага 1.*
  - **Идентификатор клиента**: *введите значение из шага 1.*
  - **URL-адрес выдачи маркера**: *введите значение из шага 1.*



## <a name="information-shared-between-your-intune-tenant-and-your-cisco-ise-server"></a>Данные, которыми обмениваются клиент Intune и сервер Cisco ISE
В следующей таблице приведены данные, которыми обмениваются клиент Intune и сервер Cisco ISE для устройств, управляемых Intune.

|Свойство|  Описание|
|---------------|------------------------------------------------------------|
|complianceState|Значение true или false (строка) указывает, соответствует ли устройство требованиям.|
|IsManaged|Значение true или false указывает, выполняется ли управление клиентом с помощью Intune.|
|macAddress|MAC-адрес устройства.|
|серийный номер|Серийный номер устройства. Применяется только к устройствам iOS.|
|imei|Номер IMEI (15-разрядное число: 14 цифр и одна контрольная цифра) или IMEISV (16 разрядов) содержит сведения о происхождении, модели и серийном номере устройства. Структура этого номера определяется в стандарте 3GPP TS 23.003. Применяется только к устройствам с SIM-картами.|
|udid|Уникальный идентификатор устройства — последовательность из 40 букв и цифр. Относится только к устройствам iOS.|
|meid|Идентификатор мобильного оборудования, глобальный уникальный номер, определяющий физическое мобильное устройство CDMA. Формат номера определяется в стандарте 3GPP2 S. R0048. С практической точки зрения он может считаться номером IMEI, но на основе шестнадцатеричного значения. Номер MEID является 56-разрядным числом (14 шестнадцатеричных цифр). Он состоит из трех полей, включая 8-разрядный код региона (RR), 24-разрядный код производителя и присвоенный производителем 24-разрядный серийный номер.|
|osVersion|Версия операционной системы устройства.
|для базы данных модели|Модель устройства.
|manufacturer|Изготовитель устройства.
|azureDeviceId|Идентификатор устройства после его присоединения к Azure Active Directory. Для неприсоединенных устройств это пустой идентификатор GUID.|
|lastContactTimeUtc|Дата и время, когда устройство последний раз регистрировалось в службе управления Intune.


## <a name="user-experience"></a>Взаимодействие с пользователем

Когда пользователь пытается получить доступ к ресурсам с помощью незарегистрированного устройства, он получит приглашение для регистрации, как показано ниже.

![Пример запроса регистрации](../media/cisco-ise-user-iphone.png)

Если пользователь выберет регистрацию, он будет перенаправлен к процедуре регистрации Intune. Процедура регистрации пользователей для Intune описана в следующих разделах:

- [Регистрация устройства с Android в Intune](/intune-user-help/enroll-your-device-in-Intune-android)</br>
- [Регистрация устройства с iOS в Intune](/intune-user-help/enroll-your-device-in-intune-ios)</br>
- [Регистрация устройства с Mac OS X в Intune](/intune-user-help/enroll-your-device-in-intune-mac-os-x)</br>
- [Регистрация устройства с Windows в Intune](/intune-user-help/enroll-your-device-in-intune-windows)</br>

Также можно [загрузить набор инструкций по регистрации](https://gallery.technet.microsoft.com/End-user-Intune-enrollment-55dfd64a), с помощью которых можно составить свое собственное руководство для пользователей.


### <a name="see-also"></a>См. также

[Руководство администратора по Cisco Identity Services Engine, выпуск 2.1](http://www.cisco.com/c/en/us/td/docs/security/ise/2-1/admin_guide/b_ise_admin_guide_21/b_ise_admin_guide_20_chapter_01000.html#task_820C9C2A1A6647E995CA5AAB01E1CDEF)
